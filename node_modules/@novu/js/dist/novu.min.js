"use strict";(()=>{var ao=Object.create;var Jt=Object.defineProperty,co=Object.defineProperties,lo=Object.getOwnPropertyDescriptor,fo=Object.getOwnPropertyDescriptors,ho=Object.getOwnPropertyNames,Xt=Object.getOwnPropertySymbols,uo=Object.getPrototypeOf,zi=Object.prototype.hasOwnProperty,zr=Object.prototype.propertyIsEnumerable;var Wr=i=>{throw TypeError(i)};var qr=(i,e,t)=>e in i?Jt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,b=(i,e)=>{for(var t in e||(e={}))zi.call(e,t)&&qr(i,t,e[t]);if(Xt)for(var t of Xt(e))zr.call(e,t)&&qr(i,t,e[t]);return i},T=(i,e)=>co(i,fo(e));var w=(i=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(i,{get:(e,t)=>(typeof require!="undefined"?require:e)[t]}):i)(function(i){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')});var $r=(i,e)=>{var t={};for(var r in i)zi.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&Xt)for(var r of Xt(i))e.indexOf(r)<0&&zr.call(i,r)&&(t[r]=i[r]);return t};var O=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),po=(i,e)=>{for(var t in e)Jt(i,t,{get:e[t],enumerable:!0})},mo=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ho(e))!zi.call(i,s)&&s!==t&&Jt(i,s,{get:()=>e[s],enumerable:!(r=lo(e,s))||r.enumerable});return i};var G=(i,e,t)=>(t=i!=null?ao(uo(i)):{},mo(e||!i||!i.__esModule?Jt(t,"default",{value:i,enumerable:!0}):t,i));var Wi=(i,e,t)=>e.has(i)||Wr("Cannot "+t);var f=(i,e,t)=>(Wi(i,e,"read from private field"),t?t.call(i):e.get(i)),E=(i,e,t)=>e.has(i)?Wr("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),x=(i,e,t,r)=>(Wi(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t),Ye=(i,e,t)=>(Wi(i,e,"access private method"),t);var g=(i,e,t)=>new Promise((r,s)=>{var n=l=>{try{c(t.next(l))}catch(u){s(u)}},o=l=>{try{c(t.throw(l))}catch(u){s(u)}},c=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,o);c((t=t.apply(i,e)).next())});var Xi=O((pf,os)=>{"use strict";var it=1e3,rt=it*60,st=rt*60,De=st*24,Oo=De*7,Io=De*365.25;os.exports=function(i,e){e=e||{};var t=typeof i;if(t==="string"&&i.length>0)return Po(i);if(t==="number"&&isFinite(i))return e.long?Fo(i):Lo(i);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))};function Po(i){if(i=String(i),!(i.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*Io;case"weeks":case"week":case"w":return t*Oo;case"days":case"day":case"d":return t*De;case"hours":case"hour":case"hrs":case"hr":case"h":return t*st;case"minutes":case"minute":case"mins":case"min":case"m":return t*rt;case"seconds":case"second":case"secs":case"sec":case"s":return t*it;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Lo(i){var e=Math.abs(i);return e>=De?Math.round(i/De)+"d":e>=st?Math.round(i/st)+"h":e>=rt?Math.round(i/rt)+"m":e>=it?Math.round(i/it)+"s":i+"ms"}function Fo(i){var e=Math.abs(i);return e>=De?pi(i,e,De,"day"):e>=st?pi(i,e,st,"hour"):e>=rt?pi(i,e,rt,"minute"):e>=it?pi(i,e,it,"second"):i+" ms"}function pi(i,e,t,r){var s=e>=t*1.5;return Math.round(i/t)+" "+r+(s?"s":"")}});var Ji=O((mf,as)=>{"use strict";function Uo(i){t.debug=t,t.default=t,t.coerce=l,t.disable=n,t.enable=s,t.enabled=o,t.humanize=Xi(),t.destroy=u,Object.keys(i).forEach(a=>{t[a]=i[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let h=0;for(let d=0;d<a.length;d++)h=(h<<5)-h+a.charCodeAt(d),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(a){let h,d=null,v,C;function m(..._){if(!m.enabled)return;let A=m,N=Number(new Date),p=N-(h||N);A.diff=p,A.prev=h,A.curr=N,h=N,_[0]=t.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let y=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(k,V)=>{if(k==="%%")return"%";y++;let H=t.formatters[V];if(typeof H=="function"){let de=_[y];k=H.call(A,de),_.splice(y,1),y--}return k}),t.formatArgs.call(A,_),(A.log||t.log).apply(A,_)}return m.namespace=a,m.useColors=t.useColors(),m.color=t.selectColor(a),m.extend=r,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(v!==t.namespaces&&(v=t.namespaces,C=t.enabled(a)),C),set:_=>{d=_}}),typeof t.init=="function"&&t.init(m),m}function r(a,h){let d=t(this.namespace+(typeof h=="undefined"?":":h)+a);return d.log=this.log,d}function s(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];let h,d=(typeof a=="string"?a:"").split(/[\s,]+/),v=d.length;for(h=0;h<v;h++)d[h]&&(a=d[h].replace(/\*/g,".*?"),a[0]==="-"?t.skips.push(new RegExp("^"+a.slice(1)+"$")):t.names.push(new RegExp("^"+a+"$")))}function n(){let a=[...t.names.map(c),...t.skips.map(c).map(h=>"-"+h)].join(",");return t.enable(""),a}function o(a){if(a[a.length-1]==="*")return!0;let h,d;for(h=0,d=t.skips.length;h<d;h++)if(t.skips[h].test(a))return!1;for(h=0,d=t.names.length;h<d;h++)if(t.names[h].test(a))return!0;return!1}function c(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function l(a){return a instanceof Error?a.stack||a.message:a}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}as.exports=Uo});var cs=O((Z,mi)=>{"use strict";Z.formatArgs=Do;Z.save=Mo;Z.load=qo;Z.useColors=Bo;Z.storage=zo();Z.destroy=(()=>{let i=!1;return()=>{i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Z.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Bo(){if(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let i;return typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&(i=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(i[1],10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Do(i){if(i[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+i[0]+(this.useColors?"%c ":" ")+"+"+mi.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;i.splice(1,0,e,"color: inherit");let t=0,r=0;i[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(r=t))}),i.splice(r,0,e)}Z.log=console.debug||console.log||(()=>{});function Mo(i){try{i?Z.storage.setItem("debug",i):Z.storage.removeItem("debug")}catch(e){}}function qo(){let i;try{i=Z.storage.getItem("debug")}catch(e){}return!i&&typeof process!="undefined"&&"env"in process&&(i=process.env.DEBUG),i}function zo(){try{return localStorage}catch(i){}}mi.exports=Ji()(Z);var{formatters:Wo}=mi.exports;Wo.j=function(i){try{return JSON.stringify(i)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var fs=O((gf,ls)=>{"use strict";ls.exports=(i,e=process.argv)=>{let t=i.startsWith("-")?"":i.length===1?"-":"--",r=e.indexOf(t+i),s=e.indexOf("--");return r!==-1&&(s===-1||r<s)}});var er=O((yf,us)=>{"use strict";var $o=w("os"),hs=w("tty"),ae=fs(),{env:q}=process,Re;ae("no-color")||ae("no-colors")||ae("color=false")||ae("color=never")?Re=0:(ae("color")||ae("colors")||ae("color=true")||ae("color=always"))&&(Re=1);"FORCE_COLOR"in q&&(q.FORCE_COLOR==="true"?Re=1:q.FORCE_COLOR==="false"?Re=0:Re=q.FORCE_COLOR.length===0?1:Math.min(parseInt(q.FORCE_COLOR,10),3));function Qi(i){return i===0?!1:{level:i,hasBasic:!0,has256:i>=2,has16m:i>=3}}function Zi(i,e){if(Re===0)return 0;if(ae("color=16m")||ae("color=full")||ae("color=truecolor"))return 3;if(ae("color=256"))return 2;if(i&&!e&&Re===void 0)return 0;let t=Re||0;if(q.TERM==="dumb")return t;if(process.platform==="win32"){let r=$o.release().split(".");return Number(r[0])>=10&&Number(r[2])>=10586?Number(r[2])>=14931?3:2:1}if("CI"in q)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(r=>r in q)||q.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in q)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(q.TEAMCITY_VERSION)?1:0;if(q.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in q){let r=parseInt((q.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(q.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(q.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(q.TERM)||"COLORTERM"in q?1:t}function Vo(i){let e=Zi(i,i&&i.isTTY);return Qi(e)}us.exports={supportsColor:Vo,stdout:Qi(Zi(!0,hs.isatty(1))),stderr:Qi(Zi(!0,hs.isatty(2)))}});var ps=O((z,yi)=>{"use strict";var jo=w("tty"),gi=w("util");z.init=Qo;z.log=Yo;z.formatArgs=Go;z.save=Xo;z.load=Jo;z.useColors=Ho;z.destroy=gi.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");z.colors=[6,2,3,4,5,1];try{let i=er();i&&(i.stderr||i).level>=2&&(z.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(i){}z.inspectOpts=Object.keys(process.env).filter(i=>/^debug_/i.test(i)).reduce((i,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(s,n)=>n.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),i[t]=r,i},{});function Ho(){return"colors"in z.inspectOpts?!!z.inspectOpts.colors:jo.isatty(process.stderr.fd)}function Go(i){let{namespace:e,useColors:t}=this;if(t){let r=this.color,s="\x1B[3"+(r<8?r:"8;5;"+r),n=`  ${s};1m${e} \x1B[0m`;i[0]=n+i[0].split(`
`).join(`
`+n),i.push(s+"m+"+yi.exports.humanize(this.diff)+"\x1B[0m")}else i[0]=Ko()+e+" "+i[0]}function Ko(){return z.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Yo(...i){return process.stderr.write(gi.formatWithOptions(z.inspectOpts,...i)+`
`)}function Xo(i){i?process.env.DEBUG=i:delete process.env.DEBUG}function Jo(){return process.env.DEBUG}function Qo(i){i.inspectOpts={};let e=Object.keys(z.inspectOpts);for(let t=0;t<e.length;t++)i.inspectOpts[e[t]]=z.inspectOpts[e[t]]}yi.exports=Ji()(z);var{formatters:ds}=yi.exports;ds.o=function(i){return this.inspectOpts.colors=this.useColors,gi.inspect(i,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};ds.O=function(i){return this.inspectOpts.colors=this.useColors,gi.inspect(i,this.inspectOpts)}});var Me=O((vf,tr)=>{"use strict";typeof process=="undefined"||process.type==="renderer"||process.browser===!0||process.__nwjs?tr.exports=cs():tr.exports=ps()});var Cs=O((Nf,Ss)=>{"use strict";var nt=w("fs"),xs=w("url"),ta=w("child_process").spawn;Ss.exports=sr;sr.XMLHttpRequest=sr;function sr(i){"use strict";i=i||{};var e=this,t=w("http"),r=w("https"),s,n,o={},c=!1,l={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},u=Object.assign({},l),a=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],h=["TRACE","TRACK","CONNECT"],d=!1,v=!1,C=!1,m={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null;var _=function(p){return c||p&&a.indexOf(p.toLowerCase())===-1},A=function(p){return p&&h.indexOf(p)===-1};this.open=function(p,y,$,k,V){if(this.abort(),v=!1,C=!1,!A(p))throw new Error("SecurityError: Request method not allowed");o={method:p,url:y.toString(),async:typeof $!="boolean"?!0:$,user:k||null,password:V||null},N(this.OPENED)},this.setDisableHeaderCheck=function(p){c=p},this.setRequestHeader=function(p,y){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!_(p))return console.warn('Refused to set unsafe header "'+p+'"'),!1;if(d)throw new Error("INVALID_STATE_ERR: send flag is true");return u[p]=y,!0},this.getResponseHeader=function(p){return typeof p=="string"&&this.readyState>this.OPENED&&n.headers[p.toLowerCase()]&&!v?n.headers[p.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||v)return"";var p="";for(var y in n.headers)y!=="set-cookie"&&y!=="set-cookie2"&&(p+=y+": "+n.headers[y]+`\r
`);return p.substr(0,p.length-2)},this.getRequestHeader=function(p){return typeof p=="string"&&u[p]?u[p]:""},this.send=function(p){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(d)throw new Error("INVALID_STATE_ERR: send has already been called");var y=!1,$=!1,k=xs.parse(o.url),V;switch(k.protocol){case"https:":y=!0;case"http:":V=k.hostname;break;case"file:":$=!0;break;case void 0:case"":V="localhost";break;default:throw new Error("Protocol not supported.")}if($){if(o.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(o.async)nt.readFile(unescape(k.pathname),"utf8",function(ne,Ke){ne?e.handleError(ne,ne.errno||-1):(e.status=200,e.responseText=Ke,N(e.DONE))});else try{this.responseText=nt.readFileSync(unescape(k.pathname),"utf8"),this.status=200,N(e.DONE)}catch(ne){this.handleError(ne,ne.errno||-1)}return}var H=k.port||(y?443:80),de=k.pathname+(k.search?k.search:"");if(u.Host=V,y&&H===443||H===80||(u.Host+=":"+k.port),o.user){typeof o.password=="undefined"&&(o.password="");var Gt=new Buffer(o.user+":"+o.password);u.Authorization="Basic "+Gt.toString("base64")}o.method==="GET"||o.method==="HEAD"?p=null:p?(u["Content-Length"]=Buffer.isBuffer(p)?p.length:Buffer.byteLength(p),u["Content-Type"]||(u["Content-Type"]="text/plain;charset=UTF-8")):o.method==="POST"&&(u["Content-Length"]=0);var Kt=i.agent||!1,se={host:V,port:H,path:de,method:o.method,headers:u,agent:Kt};if(y&&(se.pfx=i.pfx,se.key=i.key,se.passphrase=i.passphrase,se.cert=i.cert,se.ca=i.ca,se.ciphers=i.ciphers,se.rejectUnauthorized=i.rejectUnauthorized!==!1),v=!1,o.async){var pt=y?r.request:t.request;d=!0,e.dispatchEvent("readystatechange");var Ge=function(ne){if(n=ne,n.statusCode===302||n.statusCode===303||n.statusCode===307){o.url=n.headers.location;var Ke=xs.parse(o.url);V=Ke.hostname;var Se={hostname:Ke.hostname,port:Ke.port,path:Ke.path,method:n.statusCode===303?"GET":o.method,headers:u};y&&(Se.pfx=i.pfx,Se.key=i.key,Se.passphrase=i.passphrase,Se.cert=i.cert,Se.ca=i.ca,Se.ciphers=i.ciphers,Se.rejectUnauthorized=i.rejectUnauthorized!==!1),s=pt(Se,Ge).on("error",Mr),s.end();return}n&&n.setEncoding&&n.setEncoding("utf8"),N(e.HEADERS_RECEIVED),e.status=n.statusCode,n.on("data",function(Yt){Yt&&(e.responseText+=Yt),d&&N(e.LOADING)}),n.on("end",function(){d&&(d=!1,N(e.DONE))}),n.on("error",function(Yt){e.handleError(Yt)})},Mr=function(ne){e.handleError(ne)};s=pt(se,Ge).on("error",Mr),i.autoUnref&&s.on("socket",ne=>{ne.unref()}),p&&s.write(p),s.end(),e.dispatchEvent("loadstart")}else{var mt=".node-xmlhttprequest-content-"+process.pid,gt=".node-xmlhttprequest-sync-"+process.pid;nt.writeFileSync(gt,"","utf8");for(var so="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(y?"s":"")+".request;var options = "+JSON.stringify(se)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+mt+"', 'NODE-XMLHTTPREQUEST-STATUS:' + response.statusCode + ',' + responseText, 'utf8');fs.unlinkSync('"+gt+"');});response.on('error', function(error) {fs.writeFileSync('"+mt+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+gt+"');});}).on('error', function(error) {fs.writeFileSync('"+mt+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+gt+"');});"+(p?"req.write('"+JSON.stringify(p).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",no=ta(process.argv[0],["-e",so]),Gc;nt.existsSync(gt););if(e.responseText=nt.readFileSync(mt,"utf8"),no.stdin.end(),nt.unlinkSync(mt),e.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var oo=e.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,"");e.handleError(oo,503)}else e.status=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1"),e.responseText=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"),N(e.DONE)}},this.handleError=function(p,y){this.status=y||0,this.statusText=p,this.responseText=p.stack,v=!0,N(this.DONE)},this.abort=function(){s&&(s.abort(),s=null),u=Object.assign({},l),this.responseText="",this.responseXML="",v=C=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||d)&&this.readyState!==this.DONE&&(d=!1,N(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(p,y){p in m||(m[p]=[]),m[p].push(y)},this.removeEventListener=function(p,y){p in m&&(m[p]=m[p].filter(function($){return $!==y}))},this.dispatchEvent=function(p){if(typeof e["on"+p]=="function"&&(this.readyState===this.DONE?setImmediate(function(){e["on"+p]()}):e["on"+p]()),p in m)for(let y=0,$=m[p].length;y<$;y++)this.readyState===this.DONE?setImmediate(function(){m[p][y].call(e)}):m[p][y].call(e)};var N=function(p){if(!(e.readyState===p||e.readyState===e.UNSENT&&C)&&(e.readyState=p,(o.async||e.readyState<e.OPENED||e.readyState===e.DONE)&&e.dispatchEvent("readystatechange"),e.readyState===e.DONE)){let y;C?y="abort":v?y="error":y="load",e.dispatchEvent(y),e.dispatchEvent("loadend")}}}});var Os=O((Uf,Ts)=>{"use strict";var{Duplex:na}=w("stream");function ks(i){i.emit("close")}function oa(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Rs(i){this.removeListener("error",Rs),this.destroy(),this.listenerCount("error")===0&&this.emit("error",i)}function aa(i,e){let t=!0,r=new na(T(b({},e),{autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1}));return i.on("message",function(n,o){let c=!o&&r._readableState.objectMode?n.toString():n;r.push(c)||i.pause()}),i.once("error",function(n){r.destroyed||(t=!1,r.destroy(n))}),i.once("close",function(){r.destroyed||r.push(null)}),r._destroy=function(s,n){if(i.readyState===i.CLOSED){n(s),process.nextTick(ks,r);return}let o=!1;i.once("error",function(l){o=!0,n(l)}),i.once("close",function(){o||n(s),process.nextTick(ks,r)}),t&&i.terminate()},r._final=function(s){if(i.readyState===i.CONNECTING){i.once("open",function(){r._final(s)});return}i._socket!==null&&(i._socket._writableState.finished?(s(),r._readableState.endEmitted&&r.destroy()):(i._socket.once("finish",function(){s()}),i.close()))},r._read=function(){i.isPaused&&i.resume()},r._write=function(s,n,o){if(i.readyState===i.CONNECTING){i.once("open",function(){r._write(s,n,o)});return}i.send(s,o)},r.on("end",oa),r.on("error",Rs),r}Ts.exports=aa});var Oe=O((Df,Is)=>{"use strict";Is.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Rt=O((Mf,bi)=>{"use strict";var{EMPTY_BUFFER:ca}=Oe();function la(i,e){if(i.length===0)return ca;if(i.length===1)return i[0];let t=Buffer.allocUnsafe(e),r=0;for(let s=0;s<i.length;s++){let n=i[s];t.set(n,r),r+=n.length}return r<e?t.slice(0,r):t}function Ps(i,e,t,r,s){for(let n=0;n<s;n++)t[r+n]=i[n]^e[n&3]}function Ls(i,e){for(let t=0;t<i.length;t++)i[t]^=e[t&3]}function fa(i){return i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}function cr(i){if(cr.readOnly=!0,Buffer.isBuffer(i))return i;let e;return i instanceof ArrayBuffer?e=Buffer.from(i):ArrayBuffer.isView(i)?e=Buffer.from(i.buffer,i.byteOffset,i.byteLength):(e=Buffer.from(i),cr.readOnly=!1),e}bi.exports={concat:la,mask:Ps,toArrayBuffer:fa,toBuffer:cr,unmask:Ls};if(!process.env.WS_NO_BUFFER_UTIL)try{let i=w("bufferutil");bi.exports.mask=function(e,t,r,s,n){n<48?Ps(e,t,r,s,n):i.mask(e,t,r,s,n)},bi.exports.unmask=function(e,t){e.length<32?Ls(e,t):i.unmask(e,t)}}catch(i){}});var Bs=O((qf,Us)=>{"use strict";var Fs=Symbol("kDone"),lr=Symbol("kRun"),fr=class{constructor(e){this[Fs]=()=>{this.pending--,this[lr]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[lr]()}[lr](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[Fs])}}};Us.exports=fr});var It=O((zf,zs)=>{"use strict";var Tt=w("zlib"),Ds=Rt(),ha=Bs(),{kStatusCode:Ms}=Oe(),ua=Buffer.from([0,0,255,255]),Ci=Symbol("permessage-deflate"),Ee=Symbol("total-length"),Ot=Symbol("callback"),Ie=Symbol("buffers"),Si=Symbol("error"),xi,hr=class{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!xi){let s=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;xi=new ha(s)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Ot];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(s=>!(t.serverNoContextTakeover===!1&&s.server_no_context_takeover||s.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>s.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!s.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{let s=t[r];if(s.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(s=s[0],r==="client_max_window_bits"){if(s!==!0){let n=+s;if(!Number.isInteger(n)||n<8||n>15)throw new TypeError(`Invalid value for parameter "${r}": ${s}`);s=n}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${s}`)}else if(r==="server_max_window_bits"){let n=+s;if(!Number.isInteger(n)||n<8||n>15)throw new TypeError(`Invalid value for parameter "${r}": ${s}`);s=n}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(s!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${s}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=s})}),e}decompress(e,t,r){xi.add(s=>{this._decompress(e,t,(n,o)=>{s(),r(n,o)})})}compress(e,t,r){xi.add(s=>{this._compress(e,t,(n,o)=>{s(),r(n,o)})})}_decompress(e,t,r){let s=this._isServer?"client":"server";if(!this._inflate){let n=`${s}_max_window_bits`,o=typeof this.params[n]!="number"?Tt.Z_DEFAULT_WINDOWBITS:this.params[n];this._inflate=Tt.createInflateRaw(T(b({},this._options.zlibInflateOptions),{windowBits:o})),this._inflate[Ci]=this,this._inflate[Ee]=0,this._inflate[Ie]=[],this._inflate.on("error",pa),this._inflate.on("data",qs)}this._inflate[Ot]=r,this._inflate.write(e),t&&this._inflate.write(ua),this._inflate.flush(()=>{let n=this._inflate[Si];if(n){this._inflate.close(),this._inflate=null,r(n);return}let o=Ds.concat(this._inflate[Ie],this._inflate[Ee]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Ee]=0,this._inflate[Ie]=[],t&&this.params[`${s}_no_context_takeover`]&&this._inflate.reset()),r(null,o)})}_compress(e,t,r){let s=this._isServer?"server":"client";if(!this._deflate){let n=`${s}_max_window_bits`,o=typeof this.params[n]!="number"?Tt.Z_DEFAULT_WINDOWBITS:this.params[n];this._deflate=Tt.createDeflateRaw(T(b({},this._options.zlibDeflateOptions),{windowBits:o})),this._deflate[Ee]=0,this._deflate[Ie]=[],this._deflate.on("data",da)}this._deflate[Ot]=r,this._deflate.write(e),this._deflate.flush(Tt.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let n=Ds.concat(this._deflate[Ie],this._deflate[Ee]);t&&(n=n.slice(0,n.length-4)),this._deflate[Ot]=null,this._deflate[Ee]=0,this._deflate[Ie]=[],t&&this.params[`${s}_no_context_takeover`]&&this._deflate.reset(),r(null,n)})}};zs.exports=hr;function da(i){this[Ie].push(i),this[Ee]+=i.length}function qs(i){if(this[Ee]+=i.length,this[Ci]._maxPayload<1||this[Ee]<=this[Ci]._maxPayload){this[Ie].push(i);return}this[Si]=new RangeError("Max payload size exceeded"),this[Si].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Si][Ms]=1009,this.removeListener("data",qs),this.reset()}function pa(i){this[Ci]._inflate=null,i[Ms]=1007,this[Ot](i)}});var Pt=O(($f,ur)=>{"use strict";var ma=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function ga(i){return i>=1e3&&i<=1014&&i!==1004&&i!==1005&&i!==1006||i>=3e3&&i<=4999}function Ws(i){let e=i.length,t=0;for(;t<e;)if(!(i[t]&128))t++;else if((i[t]&224)===192){if(t+1===e||(i[t+1]&192)!==128||(i[t]&254)===192)return!1;t+=2}else if((i[t]&240)===224){if(t+2>=e||(i[t+1]&192)!==128||(i[t+2]&192)!==128||i[t]===224&&(i[t+1]&224)===128||i[t]===237&&(i[t+1]&224)===160)return!1;t+=3}else if((i[t]&248)===240){if(t+3>=e||(i[t+1]&192)!==128||(i[t+2]&192)!==128||(i[t+3]&192)!==128||i[t]===240&&(i[t+1]&240)===128||i[t]===244&&i[t+1]>143||i[t]>244)return!1;t+=4}else return!1;return!0}ur.exports={isValidStatusCode:ga,isValidUTF8:Ws,tokenChars:ma};if(!process.env.WS_NO_UTF_8_VALIDATE)try{let i=w("utf-8-validate");ur.exports.isValidUTF8=function(e){return e.length<150?Ws(e):i(e)}}catch(i){}});var gr=O((Vf,Ys)=>{"use strict";var{Writable:ya}=w("stream"),$s=It(),{BINARY_TYPES:va,EMPTY_BUFFER:Vs,kStatusCode:_a,kWebSocket:Ea}=Oe(),{concat:dr,toArrayBuffer:ba,unmask:xa}=Rt(),{isValidStatusCode:Sa,isValidUTF8:js}=Pt(),Lt=0,Hs=1,Gs=2,Ks=3,pr=4,Ca=5,mr=class extends ya{constructor(e={}){super(),this._binaryType=e.binaryType||va[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Ea]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=Lt,this._loop=!1}_write(e,t,r){if(this._opcode===8&&this._state==Lt)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=r.slice(e),r.slice(0,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],s=t.length-e;e>=r.length?t.set(this._buffers.shift(),s):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),s),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do switch(this._state){case Lt:t=this.getInfo();break;case Hs:t=this.getPayloadLength16();break;case Gs:t=this.getPayloadLength64();break;case Ks:this.getMask();break;case pr:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,B(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let t=(e[0]&64)===64;if(t&&!this._extensions[$s.extensionName])return this._loop=!1,B(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,B(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,B(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,B(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,B(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,B(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,B(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,B(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,B(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,B(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=Hs;else if(this._payloadLength===127)this._state=Gs;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,B(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,B(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=Ks:this._state=pr}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=pr}getData(e){let t=Vs;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&xa(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=Ca,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[$s.extensionName].decompress(e,this._fin,(s,n)=>{if(s)return t(s);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(B(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(n)}let o=this.dataMessage();if(o)return t(o);this.startLoop(t)})}dataMessage(){if(this._fin){let e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let r;this._binaryType==="nodebuffer"?r=dr(t,e):this._binaryType==="arraybuffer"?r=ba(dr(t,e)):r=t,this.emit("message",r,!0)}else{let r=dr(t,e);if(!this._skipUTF8Validation&&!js(r))return this._loop=!1,B(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",r,!1)}}this._state=Lt}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,Vs),this.end();else{if(e.length===1)return B(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{let t=e.readUInt16BE(0);if(!Sa(t))return B(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let r=e.slice(2);if(!this._skipUTF8Validation&&!js(r))return B(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,r),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=Lt}};Ys.exports=mr;function B(i,e,t,r,s){let n=new i(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(n,B),n.code=s,n[_a]=r,n}});var vr=O((Gf,Qs)=>{"use strict";var jf=w("net"),Hf=w("tls"),{randomFillSync:wa}=w("crypto"),Xs=It(),{EMPTY_BUFFER:Na}=Oe(),{isValidStatusCode:Aa}=Pt(),{mask:Js,toBuffer:ot}=Rt(),he=Symbol("kByteLength"),ka=Buffer.alloc(4),yr=class i{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r,s=!1,n=2,o=!1;t.mask&&(r=t.maskBuffer||ka,t.generateMask?t.generateMask(r):wa(r,0,4),o=(r[0]|r[1]|r[2]|r[3])===0,n=6);let c;typeof e=="string"?(!t.mask||o)&&t[he]!==void 0?c=t[he]:(e=Buffer.from(e),c=e.length):(c=e.length,s=t.mask&&t.readOnly&&!o);let l=c;c>=65536?(n+=8,l=127):c>125&&(n+=2,l=126);let u=Buffer.allocUnsafe(s?c+n:n);return u[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(u[0]|=64),u[1]=l,l===126?u.writeUInt16BE(c,2):l===127&&(u[2]=u[3]=0,u.writeUIntBE(c,4,6)),t.mask?(u[1]|=128,u[n-4]=r[0],u[n-3]=r[1],u[n-2]=r[2],u[n-1]=r[3],o?[u,e]:s?(Js(e,r,u,n,c),[u]):(Js(e,r,e,0,c),[u,e])):[u,e]}close(e,t,r,s){let n;if(e===void 0)n=Na;else{if(typeof e!="number"||!Aa(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)n=Buffer.allocUnsafe(2),n.writeUInt16BE(e,0);else{let c=Buffer.byteLength(t);if(c>123)throw new RangeError("The message must not be greater than 123 bytes");n=Buffer.allocUnsafe(2+c),n.writeUInt16BE(e,0),typeof t=="string"?n.write(t,2):n.set(t,2)}}let o={[he]:n.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,n,!1,o,s]):this.sendFrame(i.frame(n,o),s)}ping(e,t,r){let s,n;if(typeof e=="string"?(s=Buffer.byteLength(e),n=!1):(e=ot(e),s=e.length,n=ot.readOnly),s>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[he]:s,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:n,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(i.frame(e,o),r)}pong(e,t,r){let s,n;if(typeof e=="string"?(s=Buffer.byteLength(e),n=!1):(e=ot(e),s=e.length,n=ot.readOnly),s>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[he]:s,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:n,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(i.frame(e,o),r)}send(e,t,r){let s=this._extensions[Xs.extensionName],n=t.binary?2:1,o=t.compress,c,l;if(typeof e=="string"?(c=Buffer.byteLength(e),l=!1):(e=ot(e),c=e.length,l=ot.readOnly),this._firstFragment?(this._firstFragment=!1,o&&s&&s.params[s._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=c>=s._threshold),this._compress=o):(o=!1,n=0),t.fin&&(this._firstFragment=!0),s){let u={[he]:c,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:n,readOnly:l,rsv1:o};this._deflating?this.enqueue([this.dispatch,e,this._compress,u,r]):this.dispatch(e,this._compress,u,r)}else this.sendFrame(i.frame(e,{[he]:c,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:n,readOnly:l,rsv1:!1}),r)}dispatch(e,t,r,s){if(!t){this.sendFrame(i.frame(e,r),s);return}let n=this._extensions[Xs.extensionName];this._bufferedBytes+=r[he],this._deflating=!0,n.compress(e,r.fin,(o,c)=>{if(this._socket.destroyed){let l=new Error("The socket was closed while data was being compressed");typeof s=="function"&&s(l);for(let u=0;u<this._queue.length;u++){let a=this._queue[u],h=a[a.length-1];typeof h=="function"&&h(l)}return}this._bufferedBytes-=r[he],this._deflating=!1,r.readOnly=!1,this.sendFrame(i.frame(c,r),s),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][he],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][he],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};Qs.exports=yr});var cn=O((Kf,an)=>{"use strict";var{kForOnEventAttribute:Ft,kListener:_r}=Oe(),Zs=Symbol("kCode"),en=Symbol("kData"),tn=Symbol("kError"),rn=Symbol("kMessage"),sn=Symbol("kReason"),at=Symbol("kTarget"),nn=Symbol("kType"),on=Symbol("kWasClean"),be=class{constructor(e){this[at]=null,this[nn]=e}get target(){return this[at]}get type(){return this[nn]}};Object.defineProperty(be.prototype,"target",{enumerable:!0});Object.defineProperty(be.prototype,"type",{enumerable:!0});var qe=class extends be{constructor(e,t={}){super(e),this[Zs]=t.code===void 0?0:t.code,this[sn]=t.reason===void 0?"":t.reason,this[on]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[Zs]}get reason(){return this[sn]}get wasClean(){return this[on]}};Object.defineProperty(qe.prototype,"code",{enumerable:!0});Object.defineProperty(qe.prototype,"reason",{enumerable:!0});Object.defineProperty(qe.prototype,"wasClean",{enumerable:!0});var ct=class extends be{constructor(e,t={}){super(e),this[tn]=t.error===void 0?null:t.error,this[rn]=t.message===void 0?"":t.message}get error(){return this[tn]}get message(){return this[rn]}};Object.defineProperty(ct.prototype,"error",{enumerable:!0});Object.defineProperty(ct.prototype,"message",{enumerable:!0});var Ut=class extends be{constructor(e,t={}){super(e),this[en]=t.data===void 0?null:t.data}get data(){return this[en]}};Object.defineProperty(Ut.prototype,"data",{enumerable:!0});var Ra={addEventListener(i,e,t={}){for(let s of this.listeners(i))if(!t[Ft]&&s[_r]===e&&!s[Ft])return;let r;if(i==="message")r=function(n,o){let c=new Ut("message",{data:o?n:n.toString()});c[at]=this,wi(e,this,c)};else if(i==="close")r=function(n,o){let c=new qe("close",{code:n,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});c[at]=this,wi(e,this,c)};else if(i==="error")r=function(n){let o=new ct("error",{error:n,message:n.message});o[at]=this,wi(e,this,o)};else if(i==="open")r=function(){let n=new be("open");n[at]=this,wi(e,this,n)};else return;r[Ft]=!!t[Ft],r[_r]=e,t.once?this.once(i,r):this.on(i,r)},removeEventListener(i,e){for(let t of this.listeners(i))if(t[_r]===e&&!t[Ft]){this.removeListener(i,t);break}}};an.exports={CloseEvent:qe,ErrorEvent:ct,Event:be,EventTarget:Ra,MessageEvent:Ut};function wi(i,e,t){typeof i=="object"&&i.handleEvent?i.handleEvent.call(i,t):i.call(e,t)}});var Er=O((Yf,ln)=>{"use strict";var{tokenChars:Bt}=Pt();function me(i,e,t){i[e]===void 0?i[e]=[t]:i[e].push(t)}function Ta(i){let e=Object.create(null),t=Object.create(null),r=!1,s=!1,n=!1,o,c,l=-1,u=-1,a=-1,h=0;for(;h<i.length;h++)if(u=i.charCodeAt(h),o===void 0)if(a===-1&&Bt[u]===1)l===-1&&(l=h);else if(h!==0&&(u===32||u===9))a===-1&&l!==-1&&(a=h);else if(u===59||u===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${h}`);a===-1&&(a=h);let v=i.slice(l,a);u===44?(me(e,v,t),t=Object.create(null)):o=v,l=a=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);else if(c===void 0)if(a===-1&&Bt[u]===1)l===-1&&(l=h);else if(u===32||u===9)a===-1&&l!==-1&&(a=h);else if(u===59||u===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${h}`);a===-1&&(a=h),me(t,i.slice(l,a),!0),u===44&&(me(e,o,t),t=Object.create(null),o=void 0),l=a=-1}else if(u===61&&l!==-1&&a===-1)c=i.slice(l,h),l=a=-1;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(s){if(Bt[u]!==1)throw new SyntaxError(`Unexpected character at index ${h}`);l===-1?l=h:r||(r=!0),s=!1}else if(n)if(Bt[u]===1)l===-1&&(l=h);else if(u===34&&l!==-1)n=!1,a=h;else if(u===92)s=!0;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(u===34&&i.charCodeAt(h-1)===61)n=!0;else if(a===-1&&Bt[u]===1)l===-1&&(l=h);else if(l!==-1&&(u===32||u===9))a===-1&&(a=h);else if(u===59||u===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${h}`);a===-1&&(a=h);let v=i.slice(l,a);r&&(v=v.replace(/\\/g,""),r=!1),me(t,c,v),u===44&&(me(e,o,t),t=Object.create(null),o=void 0),c=void 0,l=a=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);if(l===-1||n||u===32||u===9)throw new SyntaxError("Unexpected end of input");a===-1&&(a=h);let d=i.slice(l,a);return o===void 0?me(e,d,t):(c===void 0?me(t,d,!0):r?me(t,c,d.replace(/\\/g,"")):me(t,c,d),me(e,o,t)),e}function Oa(i){return Object.keys(i).map(e=>{let t=i[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(s=>{let n=r[s];return Array.isArray(n)||(n=[n]),n.map(o=>o===!0?s:`${s}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}ln.exports={format:Oa,parse:Ta}});var wr=O((Jf,En)=>{"use strict";var Ia=w("events"),Pa=w("https"),La=w("http"),un=w("net"),Fa=w("tls"),{randomBytes:Ua,createHash:Ba}=w("crypto"),{Readable:Xf}=w("stream"),{URL:br}=w("url"),Pe=It(),Da=gr(),Ma=vr(),{BINARY_TYPES:fn,EMPTY_BUFFER:Ni,GUID:qa,kForOnEventAttribute:xr,kListener:za,kStatusCode:Wa,kWebSocket:Y,NOOP:dn}=Oe(),{EventTarget:{addEventListener:$a,removeEventListener:Va}}=cn(),{format:ja,parse:Ha}=Er(),{toBuffer:Ga}=Rt(),Ka=30*1e3,pn=Symbol("kAborted"),Sr=[8,13],xe=["CONNECTING","OPEN","CLOSING","CLOSED"],Ya=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,F=class i extends Ia{constructor(e,t,r){super(),this._binaryType=fn[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Ni,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=i.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(r=t,t=[]):t=[t]),mn(this,e,t,r)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){fn.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let s=new Da({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new Ma(e,this._extensions,r.generateMask),this._receiver=s,this._socket=e,s[Y]=this,e[Y]=this,s.on("conclude",Qa),s.on("drain",Za),s.on("error",ec),s.on("message",tc),s.on("ping",ic),s.on("pong",rc),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",yn),e.on("data",ki),e.on("end",vn),e.on("error",_n),this._readyState=i.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=i.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Pe.extensionName]&&this._extensions[Pe.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=i.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==i.CLOSED){if(this.readyState===i.CONNECTING)return ee(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===i.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=i.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Ka)}}pause(){this.readyState===i.CONNECTING||this.readyState===i.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===i.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==i.OPEN){Cr(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||Ni,t,r)}pong(e,t,r){if(this.readyState===i.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==i.OPEN){Cr(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||Ni,t,r)}resume(){this.readyState===i.CONNECTING||this.readyState===i.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===i.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(r=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==i.OPEN){Cr(this,e,r);return}let s=b({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[Pe.extensionName]||(s.compress=!1),this._sender.send(e||Ni,s,r)}terminate(){if(this.readyState!==i.CLOSED){if(this.readyState===i.CONNECTING)return ee(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=i.CLOSING,this._socket.destroy())}}};Object.defineProperty(F,"CONNECTING",{enumerable:!0,value:xe.indexOf("CONNECTING")});Object.defineProperty(F.prototype,"CONNECTING",{enumerable:!0,value:xe.indexOf("CONNECTING")});Object.defineProperty(F,"OPEN",{enumerable:!0,value:xe.indexOf("OPEN")});Object.defineProperty(F.prototype,"OPEN",{enumerable:!0,value:xe.indexOf("OPEN")});Object.defineProperty(F,"CLOSING",{enumerable:!0,value:xe.indexOf("CLOSING")});Object.defineProperty(F.prototype,"CLOSING",{enumerable:!0,value:xe.indexOf("CLOSING")});Object.defineProperty(F,"CLOSED",{enumerable:!0,value:xe.indexOf("CLOSED")});Object.defineProperty(F.prototype,"CLOSED",{enumerable:!0,value:xe.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(i=>{Object.defineProperty(F.prototype,i,{enumerable:!0})});["open","error","close","message"].forEach(i=>{Object.defineProperty(F.prototype,`on${i}`,{enumerable:!0,get(){for(let e of this.listeners(i))if(e[xr])return e[za];return null},set(e){for(let t of this.listeners(i))if(t[xr]){this.removeListener(i,t);break}typeof e=="function"&&this.addEventListener(i,e,{[xr]:!0})}})});F.prototype.addEventListener=$a;F.prototype.removeEventListener=Va;En.exports=F;function mn(i,e,t,r){let s=T(b({protocolVersion:Sr[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},r),{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0});if(!Sr.includes(s.protocolVersion))throw new RangeError(`Unsupported protocol version: ${s.protocolVersion} (supported versions: ${Sr.join(", ")})`);let n;if(e instanceof br)n=e,i._url=e.href;else{try{n=new br(e)}catch(m){throw new SyntaxError(`Invalid URL: ${e}`)}i._url=e}let o=n.protocol==="wss:",c=n.protocol==="ws+unix:",l;if(n.protocol!=="ws:"&&!o&&!c?l=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:c&&!n.pathname?l="The URL's pathname is empty":n.hash&&(l="The URL contains a fragment identifier"),l){let m=new SyntaxError(l);if(i._redirects===0)throw m;Ai(i,m);return}let u=o?443:80,a=Ua(16).toString("base64"),h=o?Pa.request:La.request,d=new Set,v;if(s.createConnection=o?Ja:Xa,s.defaultPort=s.defaultPort||u,s.port=n.port||u,s.host=n.hostname.startsWith("[")?n.hostname.slice(1,-1):n.hostname,s.headers=T(b({},s.headers),{"Sec-WebSocket-Version":s.protocolVersion,"Sec-WebSocket-Key":a,Connection:"Upgrade",Upgrade:"websocket"}),s.path=n.pathname+n.search,s.timeout=s.handshakeTimeout,s.perMessageDeflate&&(v=new Pe(s.perMessageDeflate!==!0?s.perMessageDeflate:{},!1,s.maxPayload),s.headers["Sec-WebSocket-Extensions"]=ja({[Pe.extensionName]:v.offer()})),t.length){for(let m of t){if(typeof m!="string"||!Ya.test(m)||d.has(m))throw new SyntaxError("An invalid or duplicated subprotocol was specified");d.add(m)}s.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(s.origin&&(s.protocolVersion<13?s.headers["Sec-WebSocket-Origin"]=s.origin:s.headers.Origin=s.origin),(n.username||n.password)&&(s.auth=`${n.username}:${n.password}`),c){let m=s.path.split(":");s.socketPath=m[0],s.path=m[1]}let C;if(s.followRedirects){if(i._redirects===0){i._originalIpc=c,i._originalSecure=o,i._originalHostOrSocketPath=c?s.socketPath:n.host;let m=r&&r.headers;if(r=T(b({},r),{headers:{}}),m)for(let[_,A]of Object.entries(m))r.headers[_.toLowerCase()]=A}else if(i.listenerCount("redirect")===0){let m=c?i._originalIpc?s.socketPath===i._originalHostOrSocketPath:!1:i._originalIpc?!1:n.host===i._originalHostOrSocketPath;(!m||i._originalSecure&&!o)&&(delete s.headers.authorization,delete s.headers.cookie,m||delete s.headers.host,s.auth=void 0)}s.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(s.auth).toString("base64")),C=i._req=h(s),i._redirects&&i.emit("redirect",i.url,C)}else C=i._req=h(s);s.timeout&&C.on("timeout",()=>{ee(i,C,"Opening handshake has timed out")}),C.on("error",m=>{C===null||C[pn]||(C=i._req=null,Ai(i,m))}),C.on("response",m=>{let _=m.headers.location,A=m.statusCode;if(_&&s.followRedirects&&A>=300&&A<400){if(++i._redirects>s.maxRedirects){ee(i,C,"Maximum redirects exceeded");return}C.abort();let N;try{N=new br(_,e)}catch(p){let y=new SyntaxError(`Invalid URL: ${_}`);Ai(i,y);return}mn(i,N,t,r)}else i.emit("unexpected-response",C,m)||ee(i,C,`Unexpected server response: ${m.statusCode}`)}),C.on("upgrade",(m,_,A)=>{if(i.emit("upgrade",m),i.readyState!==F.CONNECTING)return;if(C=i._req=null,m.headers.upgrade.toLowerCase()!=="websocket"){ee(i,_,"Invalid Upgrade header");return}let N=Ba("sha1").update(a+qa).digest("base64");if(m.headers["sec-websocket-accept"]!==N){ee(i,_,"Invalid Sec-WebSocket-Accept header");return}let p=m.headers["sec-websocket-protocol"],y;if(p!==void 0?d.size?d.has(p)||(y="Server sent an invalid subprotocol"):y="Server sent a subprotocol but none was requested":d.size&&(y="Server sent no subprotocol"),y){ee(i,_,y);return}p&&(i._protocol=p);let $=m.headers["sec-websocket-extensions"];if($!==void 0){if(!v){ee(i,_,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let k;try{k=Ha($)}catch(H){ee(i,_,"Invalid Sec-WebSocket-Extensions header");return}let V=Object.keys(k);if(V.length!==1||V[0]!==Pe.extensionName){ee(i,_,"Server indicated an extension that was not requested");return}try{v.accept(k[Pe.extensionName])}catch(H){ee(i,_,"Invalid Sec-WebSocket-Extensions header");return}i._extensions[Pe.extensionName]=v}i.setSocket(_,A,{generateMask:s.generateMask,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation})}),C.end()}function Ai(i,e){i._readyState=F.CLOSING,i.emit("error",e),i.emitClose()}function Xa(i){return i.path=i.socketPath,un.connect(i)}function Ja(i){return i.path=void 0,!i.servername&&i.servername!==""&&(i.servername=un.isIP(i.host)?"":i.host),Fa.connect(i)}function ee(i,e,t){i._readyState=F.CLOSING;let r=new Error(t);Error.captureStackTrace(r,ee),e.setHeader?(e[pn]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Ai,i,r)):(e.destroy(r),e.once("error",i.emit.bind(i,"error")),e.once("close",i.emitClose.bind(i)))}function Cr(i,e,t){if(e){let r=Ga(e).length;i._socket?i._sender._bufferedBytes+=r:i._bufferedAmount+=r}if(t){let r=new Error(`WebSocket is not open: readyState ${i.readyState} (${xe[i.readyState]})`);t(r)}}function Qa(i,e){let t=this[Y];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=i,t._socket[Y]!==void 0&&(t._socket.removeListener("data",ki),process.nextTick(gn,t._socket),i===1005?t.close():t.close(i,e))}function Za(){let i=this[Y];i.isPaused||i._socket.resume()}function ec(i){let e=this[Y];e._socket[Y]!==void 0&&(e._socket.removeListener("data",ki),process.nextTick(gn,e._socket),e.close(i[Wa])),e.emit("error",i)}function hn(){this[Y].emitClose()}function tc(i,e){this[Y].emit("message",i,e)}function ic(i){let e=this[Y];e.pong(i,!e._isServer,dn),e.emit("ping",i)}function rc(i){this[Y].emit("pong",i)}function gn(i){i.resume()}function yn(){let i=this[Y];this.removeListener("close",yn),this.removeListener("data",ki),this.removeListener("end",vn),i._readyState=F.CLOSING;let e;!this._readableState.endEmitted&&!i._closeFrameReceived&&!i._receiver._writableState.errorEmitted&&(e=i._socket.read())!==null&&i._receiver.write(e),i._receiver.end(),this[Y]=void 0,clearTimeout(i._closeTimer),i._receiver._writableState.finished||i._receiver._writableState.errorEmitted?i.emitClose():(i._receiver.on("error",hn),i._receiver.on("finish",hn))}function ki(i){this[Y]._receiver.write(i)||this.pause()}function vn(){let i=this[Y];i._readyState=F.CLOSING,i._receiver.end(),this.end()}function _n(){let i=this[Y];this.removeListener("error",_n),this.on("error",dn),i&&(i._readyState=F.CLOSING,this.destroy())}});var xn=O((Zf,bn)=>{"use strict";var{tokenChars:sc}=Pt();function nc(i){let e=new Set,t=-1,r=-1,s=0;for(s;s<i.length;s++){let o=i.charCodeAt(s);if(r===-1&&sc[o]===1)t===-1&&(t=s);else if(s!==0&&(o===32||o===9))r===-1&&t!==-1&&(r=s);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${s}`);r===-1&&(r=s);let c=i.slice(t,r);if(e.has(c))throw new SyntaxError(`The "${c}" subprotocol is duplicated`);e.add(c),t=r=-1}else throw new SyntaxError(`Unexpected character at index ${s}`)}if(t===-1||r!==-1)throw new SyntaxError("Unexpected end of input");let n=i.slice(t,s);if(e.has(n))throw new SyntaxError(`The "${n}" subprotocol is duplicated`);return e.add(n),e}bn.exports={parse:nc}});var Rn=O((rh,kn)=>{"use strict";var oc=w("events"),Ri=w("http"),eh=w("https"),th=w("net"),ih=w("tls"),{createHash:ac}=w("crypto"),Sn=Er(),ze=It(),cc=xn(),lc=wr(),{GUID:fc,kWebSocket:hc}=Oe(),uc=/^[+/0-9A-Za-z]{22}==$/,Cn=0,wn=1,An=2,Nr=class extends oc{constructor(e,t){if(super(),e=b({maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:lc},e),e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Ri.createServer((r,s)=>{let n=Ri.STATUS_CODES[426];s.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),s.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let r=this.emit.bind(this,"connection");this._removeListeners=dc(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(s,n,o)=>{this.handleUpgrade(s,n,o,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Cn}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===An){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Dt,this);return}if(e&&this.once("close",e),this._state!==wn)if(this._state=wn,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Dt,this):process.nextTick(Dt,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{Dt(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,s){t.on("error",Nn);let n=e.headers["sec-websocket-key"],o=+e.headers["sec-websocket-version"];if(e.method!=="GET"){We(this,e,t,405,"Invalid HTTP method");return}if(e.headers.upgrade.toLowerCase()!=="websocket"){We(this,e,t,400,"Invalid Upgrade header");return}if(!n||!uc.test(n)){We(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(o!==8&&o!==13){We(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){Mt(t,400);return}let c=e.headers["sec-websocket-protocol"],l=new Set;if(c!==void 0)try{l=cc.parse(c)}catch(h){We(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let u=e.headers["sec-websocket-extensions"],a={};if(this.options.perMessageDeflate&&u!==void 0){let h=new ze(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let d=Sn.parse(u);d[ze.extensionName]&&(h.accept(d[ze.extensionName]),a[ze.extensionName]=h)}catch(d){We(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let h={origin:e.headers[`${o===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(h,(d,v,C,m)=>{if(!d)return Mt(t,v||401,C,m);this.completeUpgrade(a,n,l,e,t,r,s)});return}if(!this.options.verifyClient(h))return Mt(t,401)}this.completeUpgrade(a,n,l,e,t,r,s)}completeUpgrade(e,t,r,s,n,o,c){if(!n.readable||!n.writable)return n.destroy();if(n[hc])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Cn)return Mt(n,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${ac("sha1").update(t+fc).digest("base64")}`],a=new this.options.WebSocket(null);if(r.size){let h=this.options.handleProtocols?this.options.handleProtocols(r,s):r.values().next().value;h&&(u.push(`Sec-WebSocket-Protocol: ${h}`),a._protocol=h)}if(e[ze.extensionName]){let h=e[ze.extensionName].params,d=Sn.format({[ze.extensionName]:[h]});u.push(`Sec-WebSocket-Extensions: ${d}`),a._extensions=e}this.emit("headers",u,s),n.write(u.concat(`\r
`).join(`\r
`)),n.removeListener("error",Nn),a.setSocket(n,o,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(a),a.on("close",()=>{this.clients.delete(a),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Dt,this)})),c(a,s)}};kn.exports=Nr;function dc(i,e){for(let t of Object.keys(e))i.on(t,e[t]);return function(){for(let r of Object.keys(e))i.removeListener(r,e[r])}}function Dt(i){i._state=An,i.emit("close")}function Nn(){this.destroy()}function Mt(i,e,t,r){t=t||Ri.STATUS_CODES[e],r=b({Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t)},r),i.once("finish",i.destroy),i.end(`HTTP/1.1 ${e} ${Ri.STATUS_CODES[e]}\r
`+Object.keys(r).map(s=>`${s}: ${r[s]}`).join(`\r
`)+`\r
\r
`+t)}function We(i,e,t,r,s){if(i.listenerCount("wsClientError")){let n=new Error(s);Error.captureStackTrace(n,We),i.emit("wsClientError",n,t,e)}else Mt(t,r,s)}});var kr=O((Mh,Bn)=>{"use strict";function Sc(i){t.debug=t,t.default=t,t.coerce=l,t.disable=n,t.enable=s,t.enabled=o,t.humanize=Xi(),t.destroy=u,Object.keys(i).forEach(a=>{t[a]=i[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let h=0;for(let d=0;d<a.length;d++)h=(h<<5)-h+a.charCodeAt(d),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(a){let h,d=null,v,C;function m(..._){if(!m.enabled)return;let A=m,N=Number(new Date),p=N-(h||N);A.diff=p,A.prev=h,A.curr=N,h=N,_[0]=t.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let y=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(k,V)=>{if(k==="%%")return"%";y++;let H=t.formatters[V];if(typeof H=="function"){let de=_[y];k=H.call(A,de),_.splice(y,1),y--}return k}),t.formatArgs.call(A,_),(A.log||t.log).apply(A,_)}return m.namespace=a,m.useColors=t.useColors(),m.color=t.selectColor(a),m.extend=r,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(v!==t.namespaces&&(v=t.namespaces,C=t.enabled(a)),C),set:_=>{d=_}}),typeof t.init=="function"&&t.init(m),m}function r(a,h){let d=t(this.namespace+(typeof h=="undefined"?":":h)+a);return d.log=this.log,d}function s(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];let h,d=(typeof a=="string"?a:"").split(/[\s,]+/),v=d.length;for(h=0;h<v;h++)d[h]&&(a=d[h].replace(/\*/g,".*?"),a[0]==="-"?t.skips.push(new RegExp("^"+a.slice(1)+"$")):t.names.push(new RegExp("^"+a+"$")))}function n(){let a=[...t.names.map(c),...t.skips.map(c).map(h=>"-"+h)].join(",");return t.enable(""),a}function o(a){if(a[a.length-1]==="*")return!0;let h,d;for(h=0,d=t.skips.length;h<d;h++)if(t.skips[h].test(a))return!1;for(h=0,d=t.names.length;h<d;h++)if(t.names[h].test(a))return!0;return!1}function c(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function l(a){return a instanceof Error?a.stack||a.message:a}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Bn.exports=Sc});var Dn=O((te,Pi)=>{"use strict";te.formatArgs=wc;te.save=Nc;te.load=Ac;te.useColors=Cc;te.storage=kc();te.destroy=(()=>{let i=!1;return()=>{i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();te.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Cc(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function wc(i){if(i[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+i[0]+(this.useColors?"%c ":" ")+"+"+Pi.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;i.splice(1,0,e,"color: inherit");let t=0,r=0;i[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(r=t))}),i.splice(r,0,e)}te.log=console.debug||console.log||(()=>{});function Nc(i){try{i?te.storage.setItem("debug",i):te.storage.removeItem("debug")}catch(e){}}function Ac(){let i;try{i=te.storage.getItem("debug")}catch(e){}return!i&&typeof process!="undefined"&&"env"in process&&(i=process.env.DEBUG),i}function kc(){try{return localStorage}catch(i){}}Pi.exports=kr()(te);var{formatters:Rc}=Pi.exports;Rc.j=function(i){try{return JSON.stringify(i)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var qn=O((W,Fi)=>{"use strict";var Tc=w("tty"),Li=w("util");W.init=Bc;W.log=Lc;W.formatArgs=Ic;W.save=Fc;W.load=Uc;W.useColors=Oc;W.destroy=Li.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");W.colors=[6,2,3,4,5,1];try{let i=er();i&&(i.stderr||i).level>=2&&(W.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(i){}W.inspectOpts=Object.keys(process.env).filter(i=>/^debug_/i.test(i)).reduce((i,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(s,n)=>n.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),i[t]=r,i},{});function Oc(){return"colors"in W.inspectOpts?!!W.inspectOpts.colors:Tc.isatty(process.stderr.fd)}function Ic(i){let{namespace:e,useColors:t}=this;if(t){let r=this.color,s="\x1B[3"+(r<8?r:"8;5;"+r),n=`  ${s};1m${e} \x1B[0m`;i[0]=n+i[0].split(`
`).join(`
`+n),i.push(s+"m+"+Fi.exports.humanize(this.diff)+"\x1B[0m")}else i[0]=Pc()+e+" "+i[0]}function Pc(){return W.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Lc(...i){return process.stderr.write(Li.formatWithOptions(W.inspectOpts,...i)+`
`)}function Fc(i){i?process.env.DEBUG=i:delete process.env.DEBUG}function Uc(){return process.env.DEBUG}function Bc(i){i.inspectOpts={};let e=Object.keys(W.inspectOpts);for(let t=0;t<e.length;t++)i.inspectOpts[e[t]]=W.inspectOpts[e[t]]}Fi.exports=kr()(W);var{formatters:Mn}=Fi.exports;Mn.o=function(i){return this.inspectOpts.colors=this.useColors,Li.inspect(i,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Mn.O=function(i){return this.inspectOpts.colors=this.useColors,Li.inspect(i,this.inspectOpts)}});var Wt=O((qh,Rr)=>{"use strict";typeof process=="undefined"||process.type==="renderer"||process.browser===!0||process.__nwjs?Rr.exports=Dn():Rr.exports=qn()});var go="v1",yo="https://api.novu.co",vo=`${PACKAGE_NAME}@${PACKAGE_VERSION}`,Qt=class{constructor(e={}){let{apiVersion:t=go,apiUrl:r=yo,userAgent:s=vo}=e||{};this.apiVersion=t,this.apiUrl=`${r}/${this.apiVersion}`,this.headers={"Novu-API-Version":NOVU_API_VERSION,"Content-Type":"application/json","User-Agent":s}}setAuthorizationToken(e){this.headers.Authorization=`Bearer ${e}`}setHeaders(e){this.headers=b(b({},this.headers),e)}get(e,t,r=!0){return g(this,null,function*(){return this.doFetch({path:e,searchParams:t,options:{method:"GET"},unwrapEnvelope:r})})}post(e,t){return g(this,null,function*(){return this.doFetch({path:e,options:{method:"POST",body:t}})})}patch(e,t){return g(this,null,function*(){return this.doFetch({path:e,options:{method:"PATCH",body:t}})})}delete(e,t){return g(this,null,function*(){return this.doFetch({path:e,options:{method:"DELETE",body:t}})})}doFetch(n){return g(this,arguments,function*({path:e,searchParams:t,options:r,unwrapEnvelope:s=!0}){let o=_o(this.apiUrl,e,t?`?${t.toString()}`:""),c={method:(r==null?void 0:r.method)||"GET",headers:b(b({},this.headers),(r==null?void 0:r.headers)||{}),body:r!=null&&r.body?JSON.stringify(r.body):void 0},l=yield fetch(o,c);if(!l.ok){let a=yield l.json();throw new Error(`${this.headers["User-Agent"]} error. Status: ${l.status}, Message: ${a.message}`)}if(l.status===204)return;let u=yield l.json();return s?u.data:u})}};function _o(...i){return i.reduce((e,t)=>(t&&e.push(t.replace(new RegExp("(?<!https?:)\\/+","g"),"/").replace(/^\/+|\/+$/g,"")),e),[]).join("/").replace(/\/\?/,"?")}var yt="/inbox",Q=`${yt}/notifications`,L,Zt=class{constructor(e={}){this.isSessionInitialized=!1;E(this,L);x(this,L,new Qt(e))}initializeSession(s){return g(this,arguments,function*({applicationIdentifier:e,subscriberHash:t,subscriber:r}){let n=yield f(this,L).post(`${yt}/session`,{applicationIdentifier:e,subscriberHash:t,subscriber:r});return f(this,L).setAuthorizationToken(n.token),this.isSessionInitialized=!0,n})}fetchNotifications({after:e,archived:t,limit:r=10,offset:s,read:n,tags:o,snoozed:c}){let l=new URLSearchParams(`limit=${r}`);return e&&l.append("after",e),s&&l.append("offset",`${s}`),o&&o.forEach(u=>l.append("tags[]",u)),n!==void 0&&l.append("read",`${n}`),t!==void 0&&l.append("archived",`${t}`),c!==void 0&&l.append("snoozed",`${c}`),f(this,L).get(Q,l,!1)}count({filters:e}){return f(this,L).get(`${Q}/count`,new URLSearchParams({filters:JSON.stringify(e)}),!1)}read(e){return f(this,L).patch(`${Q}/${e}/read`)}unread(e){return f(this,L).patch(`${Q}/${e}/unread`)}archive(e){return f(this,L).patch(`${Q}/${e}/archive`)}unarchive(e){return f(this,L).patch(`${Q}/${e}/unarchive`)}snooze(e,t){return f(this,L).patch(`${Q}/${e}/snooze`,{snoozeUntil:t})}unsnooze(e){return f(this,L).patch(`${Q}/${e}/unsnooze`)}readAll({tags:e}){return f(this,L).post(`${Q}/read`,{tags:e})}archiveAll({tags:e}){return f(this,L).post(`${Q}/archive`,{tags:e})}archiveAllRead({tags:e}){return f(this,L).post(`${Q}/read-archive`,{tags:e})}completeAction({actionType:e,notificationId:t}){return f(this,L).patch(`${Q}/${t}/complete`,{actionType:e})}revertAction({actionType:e,notificationId:t}){return f(this,L).patch(`${Q}/${t}/revert`,{actionType:e})}fetchPreferences(e){let t=new URLSearchParams;e&&e.forEach(s=>t.append("tags[]",s));let r=t.size?`?${t.toString()}`:"";return f(this,L).get(`${yt}/preferences${r}`)}updateGlobalPreferences(e){return f(this,L).patch(`${yt}/preferences`,e)}updateWorkflowPreferences({workflowId:e,channels:t}){return f(this,L).patch(`${yt}/preferences/${e}`,t)}};L=new WeakMap;function Vr(i){return{all:i=i||new Map,on:function(e,t){var r=i.get(e);r?r.push(t):i.set(e,[t])},off:function(e,t){var r=i.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):i.set(e,[]))},emit:function(e,t){var r=i.get(e);r&&r.slice().map(function(s){s(t)}),(r=i.get("*"))&&r.slice().map(function(s){s(e,t)})}}}var Fe,ei=class{constructor(){E(this,Fe);x(this,Fe,Vr())}on(e,t){return f(this,Fe).on(e,t),()=>{this.off(e,t)}}off(e,t){f(this,Fe).off(e,t)}emit(e,t){f(this,Fe).emit(e,t)}};Fe=new WeakMap;var I=class extends Error{constructor(e,t){super(e),this.originalError=t}};var Ce,Xe,we=class{constructor({inboxServiceInstance:e,eventEmitterInstance:t}){E(this,Ce,[]);E(this,Xe);this._emitter=t,this._inboxService=e,this._emitter.on("session.initialize.resolved",({error:r,data:s})=>{s?(this.onSessionSuccess(s),f(this,Ce).forEach(c=>g(this,[c],function*({fn:n,resolve:o}){o(yield n())})),x(this,Ce,[])):r&&(this.onSessionError(r),x(this,Xe,r),f(this,Ce).forEach(({resolve:n})=>{n({error:new I("Failed to initialize session, please contact the support",r)})}),x(this,Ce,[]))})}onSessionSuccess(e){}onSessionError(e){}callWithSession(e){return g(this,null,function*(){return this._inboxService.isSessionInitialized?e():f(this,Xe)?Promise.resolve({error:new I("Failed to initialize session, please contact the support",f(this,Xe))}):new Promise((t,r)=>{f(this,Ce).push({fn:e,resolve:t,reject:r})})})}};Ce=new WeakMap,Xe=new WeakMap;var K,X,U=class{constructor(e,t,r){E(this,K);E(this,X);x(this,K,t),x(this,X,r),this.id=e.id,this.subject=e.subject,this.body=e.body,this.to=e.to,this.isRead=e.isRead,this.isArchived=e.isArchived,this.isSnoozed=e.isSnoozed,this.snoozedUntil=e.snoozedUntil,this.deliveredAt=e.deliveredAt,this.createdAt=e.createdAt,this.readAt=e.readAt,this.archivedAt=e.archivedAt,this.avatar=e.avatar,this.primaryAction=e.primaryAction,this.secondaryAction=e.secondaryAction,this.channelType=e.channelType,this.tags=e.tags,this.redirect=e.redirect,this.data=e.data,this.workflow=e.workflow}read(){return ti({emitter:f(this,K),apiService:f(this,X),args:{notification:this}})}unread(){return ii({emitter:f(this,K),apiService:f(this,X),args:{notification:this}})}archive(){return ri({emitter:f(this,K),apiService:f(this,X),args:{notification:this}})}unarchive(){return si({emitter:f(this,K),apiService:f(this,X),args:{notification:this}})}snooze(e){return ni({emitter:f(this,K),apiService:f(this,X),args:{notification:this,snoozeUntil:e}})}unsnooze(){return oi({emitter:f(this,K),apiService:f(this,X),args:{notification:this}})}completePrimary(){if(!this.primaryAction)throw new Error("Primary action is not available");return Je({emitter:f(this,K),apiService:f(this,X),args:{notification:this},actionType:"primary"})}completeSecondary(){if(!this.primaryAction)throw new Error("Secondary action is not available");return Je({emitter:f(this,K),apiService:f(this,X),args:{notification:this},actionType:"secondary"})}revertPrimary(){if(!this.primaryAction)throw new Error("Primary action is not available");return Qe({emitter:f(this,K),apiService:f(this,X),args:{notification:this},actionType:"primary"})}revertSecondary(){if(!this.primaryAction)throw new Error("Secondary action is not available");return Qe({emitter:f(this,K),apiService:f(this,X),args:{notification:this},actionType:"secondary"})}on(e,t){let r=f(this,K).on(e,t);return()=>{r()}}off(e,t){f(this,K).off(e,t)}};K=new WeakMap,X=new WeakMap;var ti=r=>g(void 0,[r],function*({emitter:i,apiService:e,args:t}){let{notificationId:s,optimisticValue:n}=Ne(t,{isRead:!0,readAt:new Date().toISOString(),isArchived:!1,archivedAt:void 0},{emitter:i,apiService:e});try{i.emit("notification.read.pending",{args:t,data:n});let o=yield e.read(s),c=new U(o,i,e);return i.emit("notification.read.resolved",{args:t,data:c}),{data:c}}catch(o){return i.emit("notification.read.resolved",{args:t,error:o}),{error:new I("Failed to read notification",o)}}}),ii=r=>g(void 0,[r],function*({emitter:i,apiService:e,args:t}){let{notificationId:s,optimisticValue:n}=Ne(t,{isRead:!1,readAt:null,isArchived:!1,archivedAt:void 0},{emitter:i,apiService:e});try{i.emit("notification.unread.pending",{args:t,data:n});let o=yield e.unread(s),c=new U(o,i,e);return i.emit("notification.unread.resolved",{args:t,data:c}),{data:c}}catch(o){return i.emit("notification.unread.resolved",{args:t,error:o}),{error:new I("Failed to unread notification",o)}}}),ri=r=>g(void 0,[r],function*({emitter:i,apiService:e,args:t}){let{notificationId:s,optimisticValue:n}=Ne(t,{isArchived:!0,archivedAt:new Date().toISOString(),isRead:!0,readAt:new Date().toISOString()},{emitter:i,apiService:e});try{i.emit("notification.archive.pending",{args:t,data:n});let o=yield e.archive(s),c=new U(o,i,e);return i.emit("notification.archive.resolved",{args:t,data:c}),{data:c}}catch(o){return i.emit("notification.archive.resolved",{args:t,error:o}),{error:new I("Failed to archive notification",o)}}}),si=r=>g(void 0,[r],function*({emitter:i,apiService:e,args:t}){let{notificationId:s,optimisticValue:n}=Ne(t,{isArchived:!1,archivedAt:null,isRead:!0,readAt:new Date().toISOString()},{emitter:i,apiService:e});try{i.emit("notification.unarchive.pending",{args:t,data:n});let o=yield e.unarchive(s),c=new U(o,i,e);return i.emit("notification.unarchive.resolved",{args:t,data:c}),{data:c}}catch(o){return i.emit("notification.unarchive.resolved",{args:t,error:o}),{error:new I("Failed to unarchive notification",o)}}}),ni=r=>g(void 0,[r],function*({emitter:i,apiService:e,args:t}){let{notificationId:s,optimisticValue:n}=Ne(t,{isSnoozed:!0,snoozedUntil:t.snoozeUntil},{emitter:i,apiService:e});try{i.emit("notification.snooze.pending",{args:t,data:n});let o=yield e.snooze(s,t.snoozeUntil),c=new U(o,i,e);return i.emit("notification.snooze.resolved",{args:t,data:c}),{data:c}}catch(o){return i.emit("notification.snooze.resolved",{args:t,error:o}),{error:new I("Failed to snooze notification",o)}}}),oi=r=>g(void 0,[r],function*({emitter:i,apiService:e,args:t}){let{notificationId:s,optimisticValue:n}=Ne(t,{isSnoozed:!1,snoozedUntil:null},{emitter:i,apiService:e});try{i.emit("notification.unsnooze.pending",{args:t,data:n});let o=yield e.unsnooze(s),c=new U(o,i,e);return i.emit("notification.unsnooze.resolved",{args:t,data:c}),{data:c}}catch(o){return i.emit("notification.unsnooze.resolved",{args:t,error:o}),{error:new I("Failed to unsnooze notification",o)}}}),Je=s=>g(void 0,[s],function*({emitter:i,apiService:e,args:t,actionType:r}){let n=r==="primary"?{primaryAction:T(b({},"notification"in t?t.notification.primaryAction:{}),{isCompleted:!0})}:{secondaryAction:T(b({},"notification"in t?t.notification.secondaryAction:{}),{isCompleted:!0})},{notificationId:o,optimisticValue:c}=Ne(t,n,{emitter:i,apiService:e});try{i.emit("notification.complete_action.pending",{args:t,data:c});let l=yield e.completeAction({actionType:r,notificationId:o}),u=new U(l,i,e);return i.emit("notification.complete_action.resolved",{args:t,data:u}),{data:u}}catch(l){return i.emit("notification.complete_action.resolved",{args:t,error:l}),{error:new I(`Failed to complete ${r} action on the notification`,l)}}}),Qe=s=>g(void 0,[s],function*({emitter:i,apiService:e,args:t,actionType:r}){let n=r==="primary"?{primaryAction:T(b({},"notification"in t?t.notification.primaryAction:{}),{isCompleted:!1})}:{secondaryAction:T(b({},"notification"in t?t.notification.secondaryAction:{}),{isCompleted:!1})},{notificationId:o,optimisticValue:c}=Ne(t,n,{emitter:i,apiService:e});try{i.emit("notification.revert_action.pending",{args:t,data:c});let l=yield e.revertAction({actionType:r,notificationId:o}),u=new U(l,i,e);return i.emit("notification.revert_action.resolved",{args:t,data:u}),{data:u}}catch(l){return i.emit("notification.revert_action.resolved",{args:t,error:l}),{error:new I("Failed to fetch notifications",l)}}}),Ne=(i,e,t)=>"notification"in i?{notificationId:i.notification.id,optimisticValue:new U(b(b({},i.notification),e),t.emitter,t.apiService)}:{notificationId:i.notificationId},jr=s=>g(void 0,[s],function*({emitter:i,inboxService:e,notificationsCache:t,tags:r}){try{let o=t.getUniqueNotifications({tags:r}).map(c=>new U(T(b({},c),{isRead:!0,readAt:new Date().toISOString(),isArchived:!1,archivedAt:void 0}),i,e));return i.emit("notifications.read_all.pending",{args:{tags:r},data:o}),yield e.readAll({tags:r}),i.emit("notifications.read_all.resolved",{args:{tags:r},data:o}),{}}catch(n){return i.emit("notifications.read_all.resolved",{args:{tags:r},error:n}),{error:new I("Failed to read all notifications",n)}}}),Hr=s=>g(void 0,[s],function*({emitter:i,inboxService:e,notificationsCache:t,tags:r}){try{let o=t.getUniqueNotifications({tags:r}).map(c=>new U(T(b({},c),{isRead:!0,readAt:new Date().toISOString(),isArchived:!0,archivedAt:new Date().toISOString()}),i,e));return i.emit("notifications.archive_all.pending",{args:{tags:r},data:o}),yield e.archiveAll({tags:r}),i.emit("notifications.archive_all.resolved",{args:{tags:r},data:o}),{}}catch(n){return i.emit("notifications.archive_all.resolved",{args:{tags:r},error:n}),{error:new I("Failed to archive all notifications",n)}}}),Gr=s=>g(void 0,[s],function*({emitter:i,inboxService:e,notificationsCache:t,tags:r}){try{let o=t.getUniqueNotifications({tags:r,read:!0}).map(c=>new U(T(b({},c),{isArchived:!0,archivedAt:new Date().toISOString()}),i,e));return i.emit("notifications.archive_all_read.pending",{args:{tags:r},data:o}),yield e.archiveAllRead({tags:r}),i.emit("notifications.archive_all_read.resolved",{args:{tags:r},data:o}),{}}catch(n){return i.emit("notifications.archive_all_read.resolved",{args:{tags:r},error:n}),{error:new I("Failed to archive all read notifications",n)}}});var Kr=(i,e)=>i===e?!0:!i||!e||i.length!==e.length?!1:i.every((t,r)=>t===e[r]);var _l=["seen","unseen"],El=["read","unread"],$i=(i,e)=>Kr(i,e)||!i&&(e==null?void 0:e.length)===0||(i==null?void 0:i.length)===0&&!e,Vi=(i,e)=>$i(i.tags,e.tags)&&i.read===e.read&&i.archived===e.archived&&i.snoozed===e.snoozed;var ce,Ze=class{constructor(){E(this,ce);x(this,ce,new Map)}get(e){return f(this,ce).get(e)}getValues(){return Array.from(f(this,ce).values())}entries(){return Array.from(f(this,ce).entries())}keys(){return Array.from(f(this,ce).keys())}set(e,t){f(this,ce).set(e,t)}remove(e){f(this,ce).delete(e)}clear(){f(this,ce).clear()}};ce=new WeakMap;var Yr=({tags:i,read:e,archived:t,snoozed:r,limit:s,offset:n,after:o})=>Object.entries({tags:i,read:e,archived:t,snoozed:r,limit:s,offset:n,after:o}).filter(([c,l])=>l!=null&&!(Array.isArray(l)&&l.length===0)).reduce((c,[l,u])=>(c[l]=u,c),{}),ji=({tags:i,read:e,archived:t,snoozed:r,limit:s,offset:n,after:o})=>JSON.stringify(Yr({tags:i,read:e,archived:t,snoozed:r,limit:s,offset:n,after:o})),Eo=({tags:i,read:e,archived:t,snoozed:r})=>JSON.stringify(Yr({tags:i,read:e,archived:t,snoozed:r})),et=i=>JSON.parse(i),bo=["notification.read.pending","notification.read.resolved","notification.unread.pending","notification.unread.resolved","notification.complete_action.pending","notification.complete_action.resolved","notification.revert_action.pending","notification.revert_action.resolved","notifications.read_all.pending","notifications.read_all.resolved"],xo=["notification.archive.pending","notification.unarchive.pending","notification.snooze.pending","notification.unsnooze.pending","notifications.archive_all.pending","notifications.archive_all_read.pending"],Ae,M,vt=class{constructor({emitter:e}){E(this,Ae);E(this,M);this.updateNotification=(e,t)=>{let r=f(this,M).get(e);if(!r)return!1;let s=r.notifications.findIndex(o=>o.id===t.id);if(s===-1)return!1;let n=[...r.notifications];return n[s]=t,f(this,M).set(e,T(b({},r),{notifications:n})),!0};this.removeNotification=(e,t)=>{let r=f(this,M).get(e);if(!r)return!1;let s=r.notifications.findIndex(o=>o.id===t.id);if(s===-1)return!1;let n=[...r.notifications];return n.splice(s,1),f(this,M).set(e,T(b({},r),{notifications:n})),!0};this.handleNotificationEvent=({remove:e}={remove:!1})=>({data:t})=>{if(!t)return;let r=Array.isArray(t)?t:[t],s=new Set;f(this,M).keys().forEach(n=>{r.forEach(o=>{let c=!1;e?c=this.removeNotification(n,o):c=this.updateNotification(n,o),c&&s.add(Eo(et(n)))})}),s.forEach(n=>{let o=this.getAggregated(et(n));f(this,Ae).emit("notifications.list.updated",{data:o})})};x(this,Ae,e),bo.forEach(t=>{f(this,Ae).on(t,this.handleNotificationEvent())}),xo.forEach(t=>{f(this,Ae).on(t,this.handleNotificationEvent({remove:!0}))}),x(this,M,new Ze)}getAggregated(e){return f(this,M).keys().filter(r=>{let s=et(r);return Vi(s,e)}).map(r=>f(this,M).get(r)).reduce((r,s)=>s?{hasMore:s.hasMore,filter:s.filter,notifications:[...r.notifications,...s.notifications]}:r,{hasMore:!1,filter:{},notifications:[]})}has(e){return f(this,M).get(ji(e))!==void 0}set(e,t){f(this,M).set(ji(e),t)}update(e,t){this.set(e,t);let r=this.getAggregated(et(ji(e)));f(this,Ae).emit("notifications.list.updated",{data:r})}getAll(e){if(this.has(e))return this.getAggregated({tags:e.tags,read:e.read,snoozed:e.snoozed,archived:e.archived})}getUniqueNotifications({tags:e,read:t}){let r=f(this,M).keys(),s=new Map;return r.forEach(n=>{let o=et(n);if($i(e,o.tags)){let c=f(this,M).get(n);if(!c)return;c.notifications.filter(l=>typeof t=="undefined"||t===l.isRead).forEach(l=>s.set(l.id,l))}}),Array.from(s.values())}clear(e){f(this,M).keys().forEach(r=>{Vi(et(r),e)&&f(this,M).remove(r)})}clearAll(){f(this,M).clear()}};Ae=new WeakMap,M=new WeakMap;var _t,ai=class extends we{constructor({useCache:t,inboxServiceInstance:r,eventEmitterInstance:s}){super({eventEmitterInstance:s,inboxServiceInstance:r});E(this,_t);this.cache=new vt({emitter:s}),x(this,_t,t)}list(){return g(this,arguments,function*(s={}){var n=s,{limit:t=10}=n,r=$r(n,["limit"]);return this.callWithSession(()=>g(this,null,function*(){let o=b({limit:t},r);try{let c="useCache"in o?o.useCache:f(this,_t),l=c?this.cache.getAll(o):void 0;if(this._emitter.emit("notifications.list.pending",{args:o,data:l}),!l){let u=yield this._inboxService.fetchNotifications(b({limit:t},r));l={hasMore:u.hasMore,filter:u.filter,notifications:u.data.map(a=>new U(a,this._emitter,this._inboxService))},c&&(this.cache.set(o,l),l=this.cache.getAll(o))}return this._emitter.emit("notifications.list.resolved",{args:o,data:l}),{data:l}}catch(c){return this._emitter.emit("notifications.list.resolved",{args:o,error:c}),{error:new I("Failed to fetch notifications",c)}}}))})}count(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){let r=t&&"filters"in t?t.filters:[b({},t)];try{this._emitter.emit("notifications.count.pending",{args:t});let s=yield this._inboxService.count({filters:r}),n=t&&"filters"in t?{counts:s.data}:s.data[0];return this._emitter.emit("notifications.count.resolved",{args:t,data:n}),{data:n}}catch(s){return this._emitter.emit("notifications.count.resolved",{args:t,error:s}),{error:new I("Failed to count notifications",s)}}}))})}read(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return ti({emitter:this._emitter,apiService:this._inboxService,args:t})}))})}unread(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return ii({emitter:this._emitter,apiService:this._inboxService,args:t})}))})}archive(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return ri({emitter:this._emitter,apiService:this._inboxService,args:t})}))})}unarchive(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return si({emitter:this._emitter,apiService:this._inboxService,args:t})}))})}snooze(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return ni({emitter:this._emitter,apiService:this._inboxService,args:t})}))})}unsnooze(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return oi({emitter:this._emitter,apiService:this._inboxService,args:t})}))})}completePrimary(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return Je({emitter:this._emitter,apiService:this._inboxService,args:t,actionType:"primary"})}))})}completeSecondary(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return Je({emitter:this._emitter,apiService:this._inboxService,args:t,actionType:"secondary"})}))})}revertPrimary(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return Qe({emitter:this._emitter,apiService:this._inboxService,args:t,actionType:"primary"})}))})}revertSecondary(t){return g(this,null,function*(){return this.callWithSession(()=>g(this,null,function*(){return Qe({emitter:this._emitter,apiService:this._inboxService,args:t,actionType:"secondary"})}))})}readAll(){return g(this,arguments,function*({tags:t}={}){return this.callWithSession(()=>g(this,null,function*(){return jr({emitter:this._emitter,inboxService:this._inboxService,notificationsCache:this.cache,tags:t})}))})}archiveAll(){return g(this,arguments,function*({tags:t}={}){return this.callWithSession(()=>g(this,null,function*(){return Hr({emitter:this._emitter,inboxService:this._inboxService,notificationsCache:this.cache,tags:t})}))})}archiveAllRead(){return g(this,arguments,function*({tags:t}={}){return this.callWithSession(()=>g(this,null,function*(){return Gr({emitter:this._emitter,inboxService:this._inboxService,notificationsCache:this.cache,tags:t})}))})}clearCache({filter:t}={}){return t?this.cache.clear(t!=null?t:{}):this.cache.clearAll()}};_t=new WeakMap;var Xr=n=>g(void 0,[n],function*({emitter:i,apiService:e,cache:t,useCache:r,args:s}){let{workflowId:o,channels:c}=s;try{i.emit("preference.update.pending",{args:s,data:s.preference?new ke(T(b({},s.preference),{channels:b(b({},s.preference.channels),c)}),{emitterInstance:i,inboxServiceInstance:e,cache:t,useCache:r}):void 0});let l;o?l=yield e.updateWorkflowPreferences({workflowId:o,channels:c}):(So({emitter:i,apiService:e,cache:t,useCache:r,args:s}),l=yield e.updateGlobalPreferences(c));let u=new ke(l,{emitterInstance:i,inboxServiceInstance:e,cache:t,useCache:r});return i.emit("preference.update.resolved",{args:s,data:u}),{data:u}}catch(l){return i.emit("preference.update.resolved",{args:s,error:l}),{error:new I("Failed to fetch notifications",l)}}}),So=({emitter:i,apiService:e,cache:t,useCache:r,args:s})=>{let n=r?t==null?void 0:t.getAll({}):void 0;n==null||n.forEach(o=>{var c;if(o.level==="template"){let l=T(b({},o),{channels:Object.entries(o.channels).reduce((a,[h,d])=>{var C;let v=h;return a[v]=(C=s.channels[v])!=null?C:d,a},{})}),u=s.preference?new ke(l,{emitterInstance:i,inboxServiceInstance:e,cache:t,useCache:r}):void 0;u&&i.emit("preference.update.pending",{args:{workflowId:(c=o.workflow)==null?void 0:c.id,channels:u.channels},data:u})}})};var Et,bt,xt,St,ke=class{constructor(e,{emitterInstance:t,inboxServiceInstance:r,cache:s,useCache:n}){E(this,Et);E(this,bt);E(this,xt);E(this,St);x(this,Et,t),x(this,bt,r),x(this,xt,s),x(this,St,n),this.level=e.level,this.enabled=e.enabled,this.channels=e.channels,this.workflow=e.workflow}update({channels:e,channelPreferences:t}){var r;return Xr({emitter:f(this,Et),apiService:f(this,bt),cache:f(this,xt),useCache:f(this,St),args:{workflowId:(r=this.workflow)==null?void 0:r.id,channels:e||t,preference:{level:this.level,enabled:this.enabled,channels:this.channels,workflow:this.workflow}}})}};Et=new WeakMap,bt=new WeakMap,xt=new WeakMap,St=new WeakMap;var Co=["preference.update.pending","preference.update.resolved"],wo=({tags:i})=>Object.entries({tags:i}).reduce((e,[t,r])=>(r==null||Array.isArray(r)&&r.length===0||(e[t]=r),e),{}),Hi=({tags:i})=>JSON.stringify(wo({tags:i})),tt,oe,ci=class{constructor({emitterInstance:e}){E(this,tt);E(this,oe);this.updatePreference=(e,t)=>{let r=f(this,oe).get(e);if(!r)return!1;let s=r.findIndex(o=>{var c,l;return((c=o.workflow)==null?void 0:c.id)===((l=t.workflow)==null?void 0:l.id)||o.level===t.level&&t.level==="global"});if(s===-1)return!1;let n=[...r];return n[s]=t,f(this,oe).set(e,n),!0};this.handlePreferenceEvent=({data:e})=>{e&&f(this,oe).keys().forEach(t=>{let r=this.updatePreference(t,e),s=f(this,oe).get(t);!r||!s||f(this,tt).emit("preferences.list.updated",{data:s})})};x(this,tt,e),Co.forEach(t=>{f(this,tt).on(t,this.handlePreferenceEvent)}),x(this,oe,new Ze)}has(e){return f(this,oe).get(Hi(e))!==void 0}set(e,t){f(this,oe).set(Hi(e),t)}getAll(e){if(this.has(e))return f(this,oe).get(Hi(e))}clearAll(){f(this,oe).clear()}};tt=new WeakMap,oe=new WeakMap;var Ue,li=class extends we{constructor({useCache:t,inboxServiceInstance:r,eventEmitterInstance:s}){super({eventEmitterInstance:s,inboxServiceInstance:r});E(this,Ue);this.cache=new ci({emitterInstance:this._emitter}),x(this,Ue,t)}list(){return g(this,arguments,function*(t={}){return this.callWithSession(()=>g(this,null,function*(){try{let r=f(this,Ue)?this.cache.getAll(t):void 0;return this._emitter.emit("preferences.list.pending",{args:t,data:r}),r||(r=(yield this._inboxService.fetchPreferences(t.tags)).map(n=>new ke(n,{emitterInstance:this._emitter,inboxServiceInstance:this._inboxService,cache:this.cache,useCache:f(this,Ue)})),f(this,Ue)&&(this.cache.set(t,r),r=this.cache.getAll(t))),this._emitter.emit("preferences.list.resolved",{args:t,data:r}),{data:r}}catch(r){throw this._emitter.emit("preferences.list.resolved",{args:t,error:r}),r}}))})}};Ue=new WeakMap;var Be,Ct,pe,fi=class{constructor(e,t,r){E(this,Be);E(this,Ct);E(this,pe);x(this,Be,r),x(this,Ct,t),x(this,pe,e)}get applicationIdentifier(){return f(this,pe).applicationIdentifier}get subscriberId(){return f(this,pe).subscriber.subscriberId}initialize(){return g(this,null,function*(){try{let{applicationIdentifier:e,subscriberHash:t,subscriber:r}=f(this,pe);f(this,Be).emit("session.initialize.pending",{args:f(this,pe)});let s=yield f(this,Ct).initializeSession({applicationIdentifier:e,subscriberHash:t,subscriber:r});f(this,Be).emit("session.initialize.resolved",{args:f(this,pe),data:s})}catch(e){f(this,Be).emit("session.initialize.resolved",{args:f(this,pe),error:e})}})}};Be=new WeakMap,Ct=new WeakMap,pe=new WeakMap;var le=Object.create(null);le.open="0";le.close="1";le.ping="2";le.pong="3";le.message="4";le.upgrade="5";le.noop="6";var wt=Object.create(null);Object.keys(le).forEach(i=>{wt[le[i]]=i});var Nt={type:"error",data:"parser error"};var At=({type:i,data:e},t,r)=>e instanceof ArrayBuffer||ArrayBuffer.isView(e)?r(t?e:"b"+Jr(e,!0).toString("base64")):r(le[i]+(e||"")),Jr=(i,e)=>Buffer.isBuffer(i)||i instanceof Uint8Array&&!e?i:i instanceof ArrayBuffer?Buffer.from(i):Buffer.from(i.buffer,i.byteOffset,i.byteLength),Gi;function Qr(i,e){if(i.data instanceof ArrayBuffer||ArrayBuffer.isView(i.data))return e(Jr(i.data,!1));At(i,!0,t=>{Gi||(Gi=new TextEncoder),e(Gi.encode(t))})}var kt=(i,e)=>{if(typeof i!="string")return{type:"message",data:Zr(i,e)};let t=i.charAt(0);if(t==="b"){let r=Buffer.from(i.substring(1),"base64");return{type:"message",data:Zr(r,e)}}return wt[t]?i.length>1?{type:wt[t],data:i.substring(1)}:{type:wt[t]}:Nt},Zr=(i,e)=>{switch(e){case"arraybuffer":return i instanceof ArrayBuffer?i:Buffer.isBuffer(i)?i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength):i.buffer;case"nodebuffer":default:return Buffer.isBuffer(i)?i:Buffer.from(i)}};var es="",ts=(i,e)=>{let t=i.length,r=new Array(t),s=0;i.forEach((n,o)=>{At(n,!1,c=>{r[o]=c,++s===t&&e(r.join(es))})})},is=(i,e)=>{let t=i.split(es),r=[];for(let s=0;s<t.length;s++){let n=kt(t[s],e);if(r.push(n),n.type==="error")break}return r};function rs(){return new TransformStream({transform(i,e){Qr(i,t=>{let r=t.length,s;if(r<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,r);else if(r<65536){s=new Uint8Array(3);let n=new DataView(s.buffer);n.setUint8(0,126),n.setUint16(1,r)}else{s=new Uint8Array(9);let n=new DataView(s.buffer);n.setUint8(0,127),n.setBigUint64(1,BigInt(r))}i.data&&typeof i.data!="string"&&(s[0]|=128),e.enqueue(s),e.enqueue(t)})}})}var Ki;function hi(i){return i.reduce((e,t)=>e+t.length,0)}function ui(i,e){if(i[0].length===e)return i.shift();let t=new Uint8Array(e),r=0;for(let s=0;s<e;s++)t[s]=i[0][r++],r===i[0].length&&(i.shift(),r=0);return i.length&&r<i[0].length&&(i[0]=i[0].slice(r)),t}function ss(i,e){Ki||(Ki=new TextDecoder);let t=[],r=0,s=-1,n=!1;return new TransformStream({transform(o,c){for(t.push(o);;){if(r===0){if(hi(t)<1)break;let l=ui(t,1);n=(l[0]&128)===128,s=l[0]&127,s<126?r=3:s===126?r=1:r=2}else if(r===1){if(hi(t)<2)break;let l=ui(t,2);s=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(hi(t)<8)break;let l=ui(t,8),u=new DataView(l.buffer,l.byteOffset,l.length),a=u.getUint32(0);if(a>Math.pow(2,21)-1){c.enqueue(Nt);break}s=a*Math.pow(2,32)+u.getUint32(4),r=3}else{if(hi(t)<s)break;let l=ui(t,s);c.enqueue(kt(n?l:Ki.decode(l),e)),r=0}if(s===0||s>i){c.enqueue(Nt);break}}}})}var Yi=4;function R(i){if(i)return No(i)}function No(i){for(var e in R.prototype)i[e]=R.prototype[e];return i}R.prototype.on=R.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};R.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};R.prototype.off=R.prototype.removeListener=R.prototype.removeAllListeners=R.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var r,s=0;s<t.length;s++)if(r=t[s],r===e||r.fn===e){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+i],this};R.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,s=t.length;r<s;++r)t[r].apply(this,e)}return this};R.prototype.emitReserved=R.prototype.emit;R.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};R.prototype.hasListeners=function(i){return!!this.listeners(i).length};var fe=global;function di(i,...e){return e.reduce((t,r)=>(i.hasOwnProperty(r)&&(t[r]=i[r]),t),{})}var Ao=fe.setTimeout,ko=fe.clearTimeout;function ve(i,e){e.useNativeTimers?(i.setTimeoutFn=Ao.bind(fe),i.clearTimeoutFn=ko.bind(fe)):(i.setTimeoutFn=fe.setTimeout.bind(fe),i.clearTimeoutFn=fe.clearTimeout.bind(fe))}var Ro=1.33;function ns(i){return typeof i=="string"?To(i):Math.ceil((i.byteLength||i.size)*Ro)}function To(i){let e=0,t=0;for(let r=0,s=i.length;r<s;r++)e=i.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}var ys=G(Me(),1);function ms(i){let e="";for(let t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e}function gs(i){let e={},t=i.split("&");for(let r=0,s=t.length;r<s;r++){let n=t[r].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}var Zo=(0,ys.default)("engine.io-client:transport"),ir=class extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}},_e=class extends R{constructor(e){super(),this.writable=!1,ve(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new ir(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"?this.write(e):Zo("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=kt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){let t=ms(e);return t.length?"?"+t:""}};var As=G(Me(),1);var bs="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),rr=64,ea={},vs=0,vi=0,_s;function Es(i){let e="";do e=bs[i%rr]+e,i=Math.floor(i/rr);while(i>0);return e}function _i(){let i=Es(+new Date);return i!==_s?(vs=0,_s=i):i+"."+Es(vs++)}for(;vi<rr;vi++)ea[bs[vi]]=vi;var or=G(Cs(),1),ar=or.default||or;function ws(){return new nr}function ia(i){let e=i.split("; "),t=e[0].indexOf("=");if(t===-1)return;let r=e[0].substring(0,t).trim();if(!r.length)return;let s=e[0].substring(t+1).trim();s.charCodeAt(0)===34&&(s=s.slice(1,-1));let n={name:r,value:s};for(let o=1;o<e.length;o++){let c=e[o].split("=");if(c.length!==2)continue;let l=c[0].trim(),u=c[1].trim();switch(l){case"Expires":n.expires=new Date(u);break;case"Max-Age":let a=new Date;a.setUTCSeconds(a.getUTCSeconds()+parseInt(u,10)),n.expires=a;break;default:}}return n}var nr=class{constructor(){this.cookies=new Map}parseCookies(e){let t=e.getResponseHeader("set-cookie");t&&t.forEach(r=>{let s=ia(r);s&&this.cookies.set(s.name,s)})}addCookies(e){let t=[];this.cookies.forEach((r,s)=>{var n;((n=r.expires)===null||n===void 0?void 0:n.getTime())<Date.now()?this.cookies.delete(s):t.push(`${s}=${r.value}`)}),t.length&&(e.setDisableHeaderCheck(!0),e.setRequestHeader("cookie",t.join("; ")))}};var J=(0,As.default)("engine.io-client:polling");function ra(){}var sa=function(){return new ar({xdomain:!1}).responseType!=null}(),Ei=class extends _e{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){let r=location.protocol==="https:",s=location.port;s||(s=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||s!==e.port}let t=e&&e.forceBase64;this.supportsBinary=sa&&!t,this.opts.withCredentials&&(this.cookieJar=ws())}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let t=()=>{J("paused"),this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(J("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){J("pre-pause polling complete"),--r||t()})),this.writable||(J("we are currently writing - waiting to pause"),r++,this.once("drain",function(){J("pre-pause writing complete"),--r||t()}))}else t()}poll(){J("polling"),this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){J("polling got data %s",e);let t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};is(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"?this.poll():J('ignoring poll - transport state "%s"',this.readyState))}doClose(){let e=()=>{J("writing close packet"),this.write([{type:"close"}])};this.readyState==="open"?(J("transport open - closing"),e()):(J("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,ts(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=_i()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Te(this.uri(),e)}doWrite(e,t){let r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(s,n)=>{this.onError("xhr post error",s,n)})}doPoll(){J("xhr poll");let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}},Te=class i extends R{constructor(e,t){super(),ve(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=t.data!==void 0?t.data:null,this.create()}create(){var e;let t=di(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;let r=this.xhr=new ar(t);try{J("xhr open %s: %s",this.method,this.uri),r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&r.setRequestHeader(s,this.opts.extraHeaders[s])}}catch(s){}if(this.method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{r.setRequestHeader("Accept","*/*")}catch(s){}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var s;r.readyState===3&&((s=this.opts.cookieJar)===null||s===void 0||s.parseCookies(r)),r.readyState===4&&(r.status===200||r.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof r.status=="number"?r.status:0)},0))},J("xhr data %s",this.data),r.send(this.data)}catch(s){this.setTimeoutFn(()=>{this.onError(s)},0);return}typeof document!="undefined"&&(this.index=i.requestsCount++,i.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=ra,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete i.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};Te.requestsCount=0;Te.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Ns);else if(typeof addEventListener=="function"){let i="onpagehide"in fe?"pagehide":"unload";addEventListener(i,Ns,!1)}}function Ns(){for(let i in Te.requests)Te.requests.hasOwnProperty(i)&&Te.requests[i].abort()}var pc=G(Os(),1),mc=G(gr(),1),gc=G(vr(),1),Tn=G(wr(),1),yc=G(Rn(),1);var On=Tn.default;var qt=On,Ti=!1,In="nodebuffer",$e=process.nextTick;var Ln=G(Me(),1);var vc=(0,Ln.default)("engine.io-client:websocket"),Pn=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",Oi=class extends _e{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,r=Pn?{}:di(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Ti&&!Pn?t?new qt(e,t):new qt(e):new qt(e,t,r)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],s=t===e.length-1;At(r,this.supportsBinary,n=>{let o={};Ti||(r.options&&(o.compress=r.options.compress),this.opts.perMessageDeflate&&(typeof n=="string"?Buffer.byteLength(n):n.length)<this.opts.perMessageDeflate.threshold&&(o.compress=!1));try{Ti?this.ws.send(n):this.ws.send(n,o)}catch(c){vc("websocket closed before onclose event")}s&&$e(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=_i()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!qt}};var Fn=G(Me(),1),zt=(0,Fn.default)("engine.io-client:webtransport"),Ii=class extends _e{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{zt("transport closed gracefully"),this.onClose()}).catch(e=>{zt("transport closed due to %s",e),this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{let t=ss(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),s=rs();s.readable.pipeTo(e.writable),this.writer=s.writable.getWriter();let n=()=>{r.read().then(({done:c,value:l})=>{if(c){zt("session is closed");return}zt("received chunk: %o",l),this.onPacket(l),n()}).catch(c=>{zt("an error occurred while reading: %s",c)})};n();let o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],s=t===e.length-1;this.writer.write(r).then(()=>{s&&$e(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}};var Ar={websocket:Oi,webtransport:Ii,polling:Ei};var _c=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ec=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function lt(i){let e=i,t=i.indexOf("["),r=i.indexOf("]");t!=-1&&r!=-1&&(i=i.substring(0,t)+i.substring(t,r).replace(/:/g,";")+i.substring(r,i.length));let s=_c.exec(i||""),n={},o=14;for(;o--;)n[Ec[o]]=s[o]||"";return t!=-1&&r!=-1&&(n.source=e,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n.pathNames=bc(n,n.path),n.queryKey=xc(n,n.query),n}function bc(i,e){let t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function xc(i,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,s,n){s&&(t[s]=n)}),t}var Un=G(Me(),1);var P=(0,Un.default)("engine.io-client:socket"),Ve=class i extends R{constructor(e,t={}){super(),this.binaryType=In,this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=lt(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=lt(t.host).host),ve(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=gs(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){P('creating transport "%s"',e);let t=Object.assign({},this.opts.query);t.EIO=Yi,t.transport=e,this.id&&(t.sid=this.id);let r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return P("options: %j",r),new Ar[e](r)}open(){let e;if(this.opts.rememberUpgrade&&i.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){P("error while creating transport: %s",t),this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){P("setting transport %s",e.name),this.transport&&(P("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){P('probing transport "%s"',e);let t=this.createTransport(e),r=!1;i.priorWebsocketSuccess=!1;let s=()=>{r||(P('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(P('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;i.priorWebsocketSuccess=t.name==="websocket",P('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{r||this.readyState!=="closed"&&(P("changing transport and sending upgrade packet"),a(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{P('probe transport "%s" failed',e);let d=new Error("probe error");d.transport=t.name,this.emitReserved("upgradeError",d)}}))};function n(){r||(r=!0,a(),t.close(),t=null)}let o=h=>{let d=new Error("probe error: "+h);d.transport=t.name,n(),P('probe transport "%s" failed because of error: %s',e,h),this.emitReserved("upgradeError",d)};function c(){o("transport closed")}function l(){o("socket closed")}function u(h){t&&h.name!==t.name&&(P('"%s" works - aborting "%s"',h.name,t.name),n())}let a=()=>{t.removeListener("open",s),t.removeListener("error",o),t.removeListener("close",c),this.off("close",l),this.off("upgrading",u)};t.once("open",s),t.once("error",o),t.once("close",c),this.once("close",l),this.once("upgrading",u),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onOpen(){if(P("socket open"),this.readyState="open",i.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){P("starting upgrade probes");let e=0,t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(P('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}else P('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this.getWritablePackets();P("flushing %d packets in socket",e.length),this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){let s=this.writeBuffer[r].data;if(s&&(t+=ns(s)),r>0&&t>this.maxPayload)return P("only send %d out of %d packets",r,this.writeBuffer.length),this.writeBuffer.slice(0,r);t+=2}return P("payload size is %d (max: %d)",t,this.maxPayload),this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,s){if(typeof t=="function"&&(s=t,t=void 0),typeof r=="function"&&(s=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;let n={type:e,data:t,options:r};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),s&&this.once("flush",s),this.flush()}close(){let e=()=>{this.onClose("forced close"),P("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){P("socket error %j",e),i.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(P('socket close with reason: "%s"',e),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){let t=[],r=0,s=e.length;for(;r<s;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}};Ve.protocol=Yi;var Ih=Ve.protocol;var Wn=G(Wt(),1),zn=(0,Wn.default)("socket.io-client:url");function $n(i,e="",t){let r=i;t=t||typeof location!="undefined"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(zn("protocol-less url %s",i),typeof t!="undefined"?i=t.protocol+"//"+i:i="https://"+i),zn("parse %s",i),r=lt(i)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";let n=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+n+":"+r.port+e,r.href=r.protocol+"://"+n+(t&&t.port===r.port?"":":"+r.port),r}var Ur={};po(Ur,{Decoder:()=>Lr,Encoder:()=>Pr,PacketType:()=>S,protocol:()=>Yn});var Dc=typeof ArrayBuffer=="function",Mc=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,Vn=Object.prototype.toString,qc=typeof Blob=="function"||typeof Blob!="undefined"&&Vn.call(Blob)==="[object BlobConstructor]",zc=typeof File=="function"||typeof File!="undefined"&&Vn.call(File)==="[object FileConstructor]";function Vt(i){return Dc&&(i instanceof ArrayBuffer||Mc(i))||qc&&i instanceof Blob||zc&&i instanceof File}function $t(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,r=i.length;t<r;t++)if($t(i[t]))return!0;return!1}if(Vt(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return $t(i.toJSON(),!0);for(let t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&$t(i[t]))return!0;return!1}function jn(i){let e=[],t=i.data,r=i;return r.data=Tr(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Tr(i,e){if(!i)return i;if(Vt(i)){let t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){let t=new Array(i.length);for(let r=0;r<i.length;r++)t[r]=Tr(i[r],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){let t={};for(let r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=Tr(i[r],e));return t}return i}function Hn(i,e){return i.data=Or(i.data,e),delete i.attachments,i}function Or(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=Or(i[t],e);else if(typeof i=="object")for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t]=Or(i[t],e));return i}var Kn=G(Me(),1),Ir=(0,Kn.default)("socket.io-parser"),Wc=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Yn=5,S;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(S||(S={}));var Pr=class{constructor(e){this.replacer=e}encode(e){return Ir("encoding packet %j",e),(e.type===S.EVENT||e.type===S.ACK)&&$t(e)?this.encodeAsBinary({type:e.type===S.EVENT?S.BINARY_EVENT:S.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===S.BINARY_EVENT||e.type===S.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),Ir("encoded %j as %s",e,t),t}encodeAsBinary(e){let t=jn(e),r=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(r),s}};function Gn(i){return Object.prototype.toString.call(i)==="[object Object]"}var Lr=class i extends R{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let r=t.type===S.BINARY_EVENT;r||t.type===S.BINARY_ACK?(t.type=r?S.EVENT:S.ACK,this.reconstructor=new Fr(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Vt(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,r={type:Number(e.charAt(0))};if(S[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===S.BINARY_EVENT||r.type===S.BINARY_ACK){let n=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let o=e.substring(n,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){let n=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(n,t)}else r.nsp="/";let s=e.charAt(t+1);if(s!==""&&Number(s)==s){let n=t+1;for(;++t;){let o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){let n=this.tryParse(e.substr(t));if(i.isPayloadValid(r.type,n))r.data=n;else throw new Error("invalid payload")}return Ir("decoded %s as %j",e,r),r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case S.CONNECT:return Gn(t);case S.DISCONNECT:return t===void 0;case S.CONNECT_ERROR:return typeof t=="string"||Gn(t);case S.EVENT:case S.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Wc.indexOf(t[0])===-1);case S.ACK:case S.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},Fr=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=Hn(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function ie(i,e,t){return i.on(e,t),function(){i.off(e,t)}}var Xn=G(Wt(),1),D=(0,Xn.default)("socket.io-client:socket"),$c=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),ft=class extends R{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[ie(e,"open",this.onopen.bind(this)),ie(e,"packet",this.onpacket.bind(this)),ie(e,"error",this.onerror.bind(this)),ie(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if($c.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let r={type:S.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let o=this.ids++;D("emitting packet with ack id %d",o);let c=t.pop();this._registerAckCallback(o,c),r.id=o}let s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)?D("discard packet as the transport is not currently writable"):this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r),this.flags={},this}_registerAckCallback(e,t){var r;let s=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(s===void 0){this.acks[e]=t;return}let n=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&(D("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(o,1));D("event with ack id %d has timed out after %d ms",e,s),t.call(this,new Error("operation has timed out"))},s);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(n),t.apply(this,[null,...o])}}emitWithAck(e,...t){let r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((s,n)=>{t.push((o,c)=>r?o?n(o):s(c):s(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...n)=>r!==this._queue[0]?void 0:(s!==null?r.tryCount>this._opts.retries&&(D("packet [%d] is discarded after %d tries",r.id,r.tryCount),this._queue.shift(),t&&t(s)):(D("packet [%d] was successfully sent",r.id),this._queue.shift(),t&&t(null,...n)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(D("draining queue"),!this.connected||this._queue.length===0)return;let t=this._queue[0];if(t.pending&&!e){D("packet [%d] has already been sent and is waiting for an ack",t.id);return}t.pending=!0,t.tryCount++,D("sending packet [%d] (try n\xB0%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){D("transport is open - connecting"),typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:S.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){D("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case S.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case S.EVENT:case S.BINARY_EVENT:this.onevent(e);break;case S.ACK:case S.BINARY_ACK:this.onack(e);break;case S.DISCONNECT:this.ondisconnect();break;case S.CONNECT_ERROR:this.destroy();let r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){let t=e.data||[];D("emitting event %j",t),e.id!=null&&(D("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,r=!1;return function(...s){r||(r=!0,D("sending ack %j",s),t.packet({type:S.ACK,id:e,data:s}))}}onack(e){let t=this.acks[e.id];typeof t=="function"?(D("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):D("bad ack %s",e.id)}onconnect(e,t){D("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){D("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(D("performing disconnect (%s)",this.nsp),this.packet({type:S.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let r of t)r.apply(this,e.data)}}};function je(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}je.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=Math.floor(e*10)&1?i+t:i-t}return Math.min(i,this.max)|0};je.prototype.reset=function(){this.attempts=0};je.prototype.setMin=function(i){this.ms=i};je.prototype.setMax=function(i){this.max=i};je.prototype.setJitter=function(i){this.jitter=i};var Jn=G(Wt(),1),j=(0,Jn.default)("socket.io-client:manager"),ht=class extends R{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,ve(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new je({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let s=t.parser||Ur;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(j("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;j("opening %s",this.uri),this.engine=new Ve(this.uri,this.opts);let t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let s=ie(t,"open",function(){r.onopen(),e&&e()}),n=c=>{j("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},o=ie(t,"error",n);if(this._timeout!==!1){let c=this._timeout;j("connect attempt will timeout after %d",c);let l=this.setTimeoutFn(()=>{j("connect attempt timed out after %d",c),s(),n(new Error("timeout")),t.close()},c);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(s),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){j("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(ie(e,"ping",this.onping.bind(this)),ie(e,"data",this.ondata.bind(this)),ie(e,"error",this.onerror.bind(this)),ie(e,"close",this.onclose.bind(this)),ie(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){$e(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){j("error",e),this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new ft(this,e,t),this.nsps[e]=r),r}_destroy(e){let t=Object.keys(this.nsps);for(let r of t)if(this.nsps[r].active){j("socket %s is still active, skipping close",r);return}this._close()}_packet(e){j("writing packet %j",e);let t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){j("cleanup"),this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){j("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){j("closed due to %s",e),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)j("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();j("will wait %dms before reconnect attempt",t),this._reconnecting=!0;let r=this.setTimeoutFn(()=>{e.skipReconnect||(j("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(j("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):(j("reconnect success"),e.onreconnect())}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var Zn=G(Wt(),1),Qn=(0,Zn.default)("socket.io-client"),jt={};function Ht(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};let t=$n(i,e.path||"/socket.io"),r=t.source,s=t.id,n=t.path,o=jt[s]&&n in jt[s].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||o,l;return c?(Qn("ignoring socket cache for %s",r),l=new ht(r,e)):(jt[s]||(Qn("new io instance for %s",r),jt[s]=new ht(r,e)),l=jt[s]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(Ht,{Manager:ht,Socket:ft,io:Ht,connect:Ht});var Vc="https://ws.novu.co",eo="notifications.notification_received",to="notifications.unseen_count_changed",io="notifications.unread_count_changed",jc=({_id:i,content:e,read:t,archived:r,snoozedUntil:s,deliveredAt:n,createdAt:o,lastReadDate:c,archivedAt:l,channel:u,subscriber:a,subject:h,avatar:d,cta:v,tags:C,data:m,workflow:_})=>{var k,V,H,de,Gt,Kt,se,pt;let A={id:a==null?void 0:a._id,subscriberId:a==null?void 0:a.subscriberId,firstName:a==null?void 0:a.firstName,lastName:a==null?void 0:a.lastName,avatar:a==null?void 0:a.avatar,locale:a==null?void 0:a.locale,data:a==null?void 0:a.data,timezone:a==null?void 0:a.timezone,email:a==null?void 0:a.email,phone:a==null?void 0:a.phone},N=(V=(k=v.action)==null?void 0:k.buttons)==null?void 0:V.find(Ge=>Ge.type==="primary"),p=(de=(H=v.action)==null?void 0:H.buttons)==null?void 0:de.find(Ge=>Ge.type==="secondary"),y=(Kt=(Gt=v.action)==null?void 0:Gt.result)==null?void 0:Kt.type,$=(se=v.action)==null?void 0:se.status;return T(b(b({id:i,subject:h,body:e,to:A,isRead:t,isArchived:r,isSnoozed:!!s},n&&{deliveredAt:n}),s&&{snoozedUntil:s}),{createdAt:o,readAt:c,archivedAt:l,avatar:d,primaryAction:N&&{label:N.content,isCompleted:y==="primary"&&$==="done",redirect:N.url?{target:N.target,url:N.url}:void 0},secondaryAction:p&&{label:p.content,isCompleted:y==="secondary"&&$==="done",redirect:p.url?{target:p.target,url:p.url}:void 0},channelType:u,tags:C,redirect:(pt=v.data)!=null&&pt.url?{url:v.data.url,target:v.data.target}:void 0,data:m,workflow:_})},ut,ue,re,dt,Bi,Di,Mi,ge,ro,Br,Dr,Ui=class extends we{constructor({socketUrl:t,inboxServiceInstance:r,eventEmitterInstance:s}){super({eventEmitterInstance:s,inboxServiceInstance:r});E(this,ge);E(this,ut);E(this,ue);E(this,re);E(this,dt);E(this,Bi,({message:t})=>{f(this,ue).emit(eo,{result:new U(jc(t),f(this,ue),this._inboxService)})});E(this,Di,({unseenCount:t})=>{f(this,ue).emit(to,{result:t})});E(this,Mi,({unreadCount:t})=>{f(this,ue).emit(io,{result:t})});x(this,ue,s),x(this,dt,t!=null?t:Vc)}onSessionSuccess({token:t}){x(this,ut,t)}isSocketEvent(t){return t===eo||t===to||t===io}connect(){return g(this,null,function*(){return f(this,ut)?Ye(this,ge,Br).call(this):this.callWithSession(Ye(this,ge,Br).bind(this))})}disconnect(){return g(this,null,function*(){return f(this,re)?Ye(this,ge,Dr).call(this):this.callWithSession(Ye(this,ge,Dr).bind(this))})}};ut=new WeakMap,ue=new WeakMap,re=new WeakMap,dt=new WeakMap,Bi=new WeakMap,Di=new WeakMap,Mi=new WeakMap,ge=new WeakSet,ro=function(){return g(this,null,function*(){var r,s,n;if(f(this,re))return;let t={socketUrl:f(this,dt)};f(this,ue).emit("socket.connect.pending",{args:t}),x(this,re,Ht(f(this,dt),{reconnectionDelayMax:1e4,transports:["websocket"],query:{token:`${f(this,ut)}`}})),f(this,re).on("connect",()=>{f(this,ue).emit("socket.connect.resolved",{args:t})}),f(this,re).on("connect_error",o=>{f(this,ue).emit("socket.connect.resolved",{args:t,error:o})}),(r=f(this,re))==null||r.on("notification_received",f(this,Bi)),(s=f(this,re))==null||s.on("unseen_count_changed",f(this,Di)),(n=f(this,re))==null||n.on("unread_count_changed",f(this,Mi))})},Br=function(){return g(this,null,function*(){try{return yield Ye(this,ge,ro).call(this),{}}catch(t){return{error:new I("Failed to initialize the socket",t)}}})},Dr=function(){return g(this,null,function*(){var t;try{return(t=f(this,re))==null||t.disconnect(),x(this,re,void 0),{}}catch(r){return{error:new I("Failed to disconnect from the socket",r)}}})};var ye,He,Le,qi=class{constructor(e){E(this,ye);E(this,He);E(this,Le);var t,r;x(this,Le,new Zt({apiUrl:e.apiUrl||e.backendUrl,userAgent:e.__userAgent})),x(this,ye,new ei),x(this,He,new fi({applicationIdentifier:e.applicationIdentifier,subscriberHash:e.subscriberHash,subscriber:Hc(e)},f(this,Le),f(this,ye))),f(this,He).initialize(),this.notifications=new ai({useCache:(t=e.useCache)!=null?t:!0,inboxServiceInstance:f(this,Le),eventEmitterInstance:f(this,ye)}),this.preferences=new li({useCache:(r=e.useCache)!=null?r:!0,inboxServiceInstance:f(this,Le),eventEmitterInstance:f(this,ye)}),this.socket=new Ui({socketUrl:e.socketUrl,eventEmitterInstance:f(this,ye),inboxServiceInstance:f(this,Le)}),this.on=(s,n)=>{this.socket.isSocketEvent(s)&&this.socket.connect();let o=f(this,ye).on(s,n);return()=>{o()}},this.off=(s,n)=>{f(this,ye).off(s,n)}}get applicationIdentifier(){return f(this,He).applicationIdentifier}get subscriberId(){return f(this,He).subscriberId}};ye=new WeakMap,He=new WeakMap,Le=new WeakMap;function Hc(i){let e;return i.subscriber?e=typeof i.subscriber=="string"?{subscriberId:i.subscriber}:i.subscriber:e={subscriberId:i.subscriberId},e}window.Novu=qi;})();
/*! Bundled license information:

xmlhttprequest-ssl/lib/XMLHttpRequest.js:
  (**
   * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
   *
   * This can be used with JS designed for browsers to improve reuse of code and
   * allow the use of existing libraries.
   *
   * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
   *
   * @author Dan DeFelippi <dan@driverdan.com>
   * @contributor David Ellis <d.f.ellis@ieee.org>
   * @license MIT
   *)
*/
